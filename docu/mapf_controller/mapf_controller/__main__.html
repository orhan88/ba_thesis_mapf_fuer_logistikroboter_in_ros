<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>mapf_controller.__main__ API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#MODE_INIT">MODE_INIT</a>
            </li>
            <li>
                    <a class="variable" href="#MODE_WAIT_SIM">MODE_WAIT_SIM</a>
            </li>
            <li>
                    <a class="variable" href="#MODE_PUB_INSTANCE">MODE_PUB_INSTANCE</a>
            </li>
            <li>
                    <a class="variable" href="#MODE_WAIT_SOLVER">MODE_WAIT_SOLVER</a>
            </li>
            <li>
                    <a class="variable" href="#MODE_PUB_SIM">MODE_PUB_SIM</a>
            </li>
            <li>
                    <a class="class" href="#Controller">Controller</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Controller.__init__">Controller</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.ctrl_state">ctrl_state</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.current_id_cycle">current_id_cycle</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.number_robots">number_robots</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.subscriber_map">subscriber_map</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.subscribers_robot">subscribers_robot</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.publishers_robot">publishers_robot</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.publisher_instance">publisher_instance</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.subscriber_instance">subscriber_instance</a>
                        </li>
                        <li>
                                <a class="variable" href="#Controller.publisher_statistics">publisher_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.callback_mapinfo">callback_mapinfo</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.callback_robotinfo">callback_robotinfo</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.callback_solution">callback_solution</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.publish_instance_msg">publish_instance_msg</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.publish_action_msg">publish_action_msg</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.publish_statistics_msg">publish_statistics_msg</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.check_init_robots">check_init_robots</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.all_agents_at_target">all_agents_at_target</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.number_robots_changed">number_robots_changed</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.clear_robots">clear_robots</a>
                        </li>
                        <li>
                                <a class="function" href="#Controller.print_missing_robot_info">print_missing_robot_info</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#run">run</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
mapf_controller<wbr>.__main__    </h1>

                
                        <input id="mod-__main__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-__main__-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#! /usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">mapf_interfaces.msg</span> <span class="kn">import</span> <span class="n">RobotAction</span><span class="p">,</span> <span class="n">RobotInfo</span><span class="p">,</span> <span class="n">MapInfo</span><span class="p">,</span> <span class="n">MAPFInstance</span><span class="p">,</span> <span class="n">MAPFSolution</span><span class="p">,</span> <span class="n">StatisticInfo</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">rclpy</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">rclpy.context</span> <span class="kn">import</span> <span class="n">Context</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">rclpy.parameter</span> <span class="kn">import</span> <span class="n">Parameter</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># Different possible states of Controller</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="n">MODE_INIT</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">&#39;&#39;&#39;= state of the module CONTROLLER at the begin of every cycle till a &quot;mapf_interfaces/MapInfo.msg&quot; has been received.&#39;&#39;&#39;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="n">MODE_WAIT_SIM</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">&#39;&#39;&#39;= state of CONTROLLER after a &quot;mapf_interfaces/MapInfo.msg&quot; (for the current cycle) has been received. </span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">     </span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">     CONTROLLER checks whether the number of the robots in the </span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">     simulation has changed and (if necessary) creates additional subscribers and publishers for new robots. </span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">     After CONTROLLER is waiting until it has received a message of type </span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">     &quot;mapf_interfaces/RobotInfo.msg&quot; from every robot in the simulation.&#39;&#39;&#39;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="n">MODE_PUB_INSTANCE</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">&#39;&#39;&#39;= state of CONTROLLER after it has received all necessary information from the simulation for the current cycle. </span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">     </span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">     CONTROLLER fuses all received information to create an Instance (&quot;mapf_interfaces/MAPFInstance.msg&quot;) which can be solved by a pathplanner&#39;&#39;&#39;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="n">MODE_WAIT_SOLVER</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">&#39;&#39;&#39;= state of CONTROLLER after it has published the generated Instance and waits for the solution from the pathplanner</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="n">MODE_PUB_SIM</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">&#39;&#39;&#39;= state of CONTROLLER after it has received a solution from the pathplanner. </span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">     </span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">     CONTROLLER generates the next action for every robot so they can follow the defined paths by the pathplanner.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">     In addition CONTROLLER generates a &quot;mapf_interfaces/StatisticInfo.msg&quot; for every received solution for the modul EVALUATOR</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    This class represents the following ros2 node: **mapf_controller_node**.  </span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    The node mapf_controller_node subscribes to the folllowing topics:  </span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    **/mapf_map_info** *[mapf_interfaces/MapInfo.msg]*, callback_mapinfo(self, msg)  </span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    **/mapf_instance_solution** *[mapf_interfaces/MAPFSolution.msg]*, callback_solution(self, msg)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    The node mapf_controller_node publishes to the folllowing topics:  </span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    **/mapf_instance_info** *[mapf_interfaces/MAPFInstance.msg]*  </span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    **/mapf_statistics_info** *[mapf_interfaces/StatisticInfo.msg]*  </span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    For every robot in the simulation an additional subscriber and publisher will be created</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    (the ID in the topic name will be replaced by the ID of the robot):  </span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    **/mapf_robot_info_ID** *[mapf_interfaces/RobotInfo.msg]*, callback_robotinfo(self, msg)  </span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    **/mapf_robot_action_ID***[mapf_interfaces/RobotAction.msg]*</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Creates an instance of the controller</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;mapf_controller_node&#39;</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span> 
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the current state of the controller. Possible values are: </span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        &gt;MODE_INIT = 0  </span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">        &gt;MODE_WAIT_SIM = 1  </span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        &gt;MODE_PUB_INSTANCE = 2  </span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        &gt;MODE_WAIT_SOLVER = 3   </span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        &gt;MODE_PUB_SIM = 4</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the current cylce. Each cycle has a unique id which is incrementing with every new cycle. &#39;&#39;&#39;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the number of robots for which the connection between the CONTROLLER and SIMULATION is created&#39;&#39;&#39;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="c1">#subscribe to &quot;mapf_map_info&quot; [MapInfo.msg]</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscriber_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">MapInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_map_info&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_mapinfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.subscription.Subscription** - ros2 subscriber to the topic */mapf_map_info*&#39;&#39;&#39;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="c1">#list of subscribers to &quot;mapf_robot_info_ID&quot; [RobotInfo.msg]</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;list of objects of type **rclpy.subscription.Subscription** - subscribers to the topics: /mapf_robot_info_&quot;ID&quot;&#39;&#39;&#39;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="c1">#list of publisher to &quot;mapf_robot_action_id&quot; [RobotAction.msg]</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;list of objects of type **rclpy.publisher.Publisher** - publishers to the topics:   </span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        /mapf_robot_action_&quot;ID&quot;&#39;&#39;&#39;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="c1">#publish Instance to &quot;mapf_instance_info&quot; [MAPFInstance.msg]</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">MAPFInstance</span><span class="p">,</span> <span class="s1">&#39;mapf_instance_info&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.publisher.Publisher** - ros2 publisher to the topic */mapf_instance_info*&#39;&#39;&#39;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="c1">#subscribe to &quot;mapf_instance_solution&quot; [MAPFSolution.msg]</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscriber_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">MAPFSolution</span><span class="p">,</span> <span class="s1">&#39;mapf_instance_solution&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_solution</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.subscription.Subscription** - ros2 subscriber to the topic */mapf_instance_solution*&#39;&#39;&#39;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="c1">#publish  to &quot;mapf_statistics_info&quot; [StatisticInfo.msg]</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">StatisticInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_statistics_info&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.publisher.Publisher** - ros2 publisher to the topic */mapf_statistics_info*&#39;&#39;&#39;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="c1">#save incoming msg here  </span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#MapInfo.msg</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#list of RobotInfo.msg</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#list of MAPFSolution.msg</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="c1">#flag if MapInfo.msg already received, so Map is initialised</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="c1">#list of flags for every robot</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="c1">#if RobotInfo message received for the robot with ID, then list[ID-1]=True</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="c1">#self._robots_received = [] #Notice: ID starts with 1 while list with 0!        </span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="c1">#self._solutions_received = []</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">callback_mapinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        This function will be called every time a message on the topic is received: */mapf_map_info*</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        If the number of the robots has not changed since the last time this function has been called </span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        then:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        &gt;1) set the init flags for every robot to FALSE (meaning the robot is not ready yet)   </span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        &gt;2) delete all old messages received for the robots on the following topics: */mapf_robot_info_&quot;ID&quot;*</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        </span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        If the number of the robots has changed since the last time this function has been called then:   </span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">        (this is although TRUE if this function is beeing called for the first time)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        &gt;1) delete old Subscribers for the topics: */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">            delete old Publishers for the topics: */mapf_robot_action_&quot;ID&quot;*  </span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">            </span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        &gt;2) for every robot create a Publisher and Subscriber  </span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        (Publisher for */mapf_robot_info_&quot;ID&quot;* and Subscriber for */mapf_robot_action_&quot;ID&quot;*)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        </span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        &gt;3) set the init flags for every robot to FALSE (meaning the robot is not ready yet)   </span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        </span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        &gt;4) delete all old messages received for the robots on the following topics:   </span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">           &gt;&gt; */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">           &gt;&gt; */mapf_instance_info_&quot;ID&quot;*  </span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">           &gt;&gt; */mapf_instance_solution_&quot;ID&quot;*  </span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        </span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        :param msg: mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="c1">#save the received msg</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="c1">#mark that map message has already been received</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="c1">#if the number of robots from last time hasn&#39;t changed then</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_robots_changed</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="k">return</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clear_robots</span><span class="p">()</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="c1">#create publisher[RobotAction.msg] and subscriber[RobotInfo.msg] for every robot</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span><span class="p">):</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="c1">#create subscriber</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            <span class="n">subscriber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">RobotInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_robot_info_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">callback_robotinfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="c1">#create publisher</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">RobotAction</span><span class="p">,</span> <span class="s1">&#39;mapf_robot_action_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">publisher</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="nf">callback_robotinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>    
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        This function will be called every time a message on the following topics is received: */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle.   </span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        If the numbers are not equal, then the information in the message is old and will be ignored.  </span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        If the numbers are equal then, the CONTROLLER saves the message and sets the INIT-flag for the corresponding robot to TRUE!  </span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        :param msg: mapf_interfaces/RobotInfo.msg - message from the topic /mapf_robot_info_ID</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RobotInfo.msg received, but with an old ID = </span><span class="si">%d</span><span class="s2">. Skip the message&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;msg.id = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;self.current_id_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="k">return</span>    
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialising ROBOT with ID: &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="p">)</span>    
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">callback_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        This function will be called every time a message on the following topics is received: */mapf_instance_solution*  </span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle.   </span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        If the numbers are not equal, then the information in the message is old and will be ignored.  </span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        If the numbers are equal, then the CONTROLLER saves the message/solution.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        :param msg: mapf_interfaces/MAPFSolution.msg - message from the topic /mapf_instance_solution</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="c1">#skip solutions for old instances </span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAPFSolution.msg received, but with an old ID = </span><span class="si">%d</span><span class="s2">. Skip the message&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;msg.id = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;self.current_id_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="k">return</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAPFSolution.msg received, ID = </span><span class="si">%d</span><span class="s2">, STEP: </span><span class="si">%d</span><span class="s2">, algorithm: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">name_algorithm</span><span class="p">))</span>                              
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="c1">#self._solution_msgs.append(msg)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">publish_instance_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/MAPFInstance.msg] and publishes it to the following topic: */mapf_instance_info*  </span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        The message will be generated by fusing the information from the arrived messages on the following topics:  </span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        */mapf_map_info* [mapf_interfaces/MapInfo.msg] and   </span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        */mapf_robot_info_ID* [mapf_interfaces/RobotInfo.msg] for every robot </span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">MAPFInstance</span><span class="p">()</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span><span class="o">.</span><span class="n">step</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="k">for</span> <span class="n">robot_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_msg</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_instance</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="c1">#save the published message for later to check with corresponding answer</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="c1">#delete all solutions for an older instance!!!!</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">publish_action_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>         
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/RobotAction.msg] and publishes it to the following topic: */mapf_robot_action_ID*  </span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        </span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        The message will be generated from the received solution by the pathplanner: */mapf_solution_info* [mapf_interfaces/MAPFSolution.msg].  </span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        The solution defines the paths for every robot. Every path is defined by a set of points. The action for every robot will be defined by the difference </span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        between the first two points from their path.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        The first point in the path describes the actual position of the robot, the second point the next target point from the path.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        </span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        :param int: solution_number - defines which solution should be used for generating the actions for the robot  </span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        (at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one </span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        solution and choose the best one of those. For that matter it should be possible to define which solution should be used here)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">for</span> <span class="n">pathInfoMsg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">[</span><span class="n">solution_number</span><span class="p">]</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="c1">#for pathInfoMsg in self.solution_msg.paths:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">RobotAction</span><span class="p">()</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">step</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">robot_id</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_x</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_x</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_y</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_y</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                      
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="k">def</span> <span class="nf">publish_statistics_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/StatisticInfo.msg]</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        and publishes it to the following topic: */mapf_statistics_info*  </span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        </span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        The content for the message can be extracted directly from the saved solution (MAPFSolution.msg).</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        :param int: solution_number - defines which solution should be used for generating the message  </span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        (at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one </span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        solution and choose the best one of those. For that matter it should be possible to define here which solution should be used)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="c1">#msg = self._solution_msgs[solution_number].statistics</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_statistics</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">[</span><span class="n">solution_number</span><span class="p">]</span><span class="o">.</span><span class="n">statistics</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">check_init_robots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        This function checks whether the flag for every robot is set to TRUE. </span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">        </span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        This function is used to check whether the information about all the robots</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        has been received by the CONTROLLER from the SIMULATION.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">        :return: **True**, if the flag for every robot is set to TRUE in the CONTROLLER  </span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        **False**, otherwise</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="k">if</span> <span class="n">robot</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="k">def</span> <span class="nf">all_agents_at_target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">        This function checks if all robots have visited all their checkpoints. If it is the case then all robots have reached their targets!</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">        :return: **True**, if all robots have visited all their checkpoints  </span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        **False**, otherwise</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">for</span> <span class="n">robot_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>           <span class="k">for</span> <span class="n">checkpoint_msg</span> <span class="ow">in</span> <span class="n">robot_msg</span><span class="o">.</span><span class="n">checkpoints</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpoint_msg</span><span class="o">.</span><span class="n">visited</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                   <span class="c1">#print(&quot;CHECKPOINT NOT VISITED&quot;)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                   <span class="c1">#print(checkpoint_msg.position.pos_x)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                   <span class="c1">#print(checkpoint_msg.position.pos_y)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                   <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>             
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>    <span class="k">def</span> <span class="nf">number_robots_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        This function checks whether the number of the robots has changed from the last time (last time CONTROLLER received the MapInfo.msg). </span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        </span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        :param msg: mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        :return: **True**, if the number of the robots has changed or if the CONTROLLER has not received any MapInfo.msg so far  </span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        **False**, if the number of the robots has not changed</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">!=</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">clear_robots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        This function is executing the following procedures:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        &gt;   1) deleting all Subscribers to and received messages on the following topics: /mapf_robot_info_&quot;ID&quot;  </span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">            2) deleting all Publishers to the following topics: /mapf_robot_action_&quot;ID&quot;  </span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">            3) deleting all created Instances for the pathplanners and all received solutions from the pathplanners  </span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">            4) at the end resets the STATE of the CONTROLLER to MODE_INIT </span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        This function is called when the number of the robots has changed. In that case the old data will be deleted </span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        and a new initialisation of the CONTROLLER with the new number of robots will be carried out.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#list of RobotInfo.msg</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#list of MAPFSolution.msg</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="c1">#list of flags for every robot</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="c1">#if RobotInfo message received for the robot with ID, then list[ID-1]=True</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="c1">#self._robots_received = [] #Notice: ID starts with 1 while list with 0!        </span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="c1">#self._solutions_received = []</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="k">def</span> <span class="nf">print_missing_robot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">        This function prints the ID-s of those robots of which the CONTROLLER is missing the information about</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">        (have not received a RobotInfo.msg for these robots with the id of the current cycle).  </span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        This function is used as a help-function for diagnostic purposes.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing RobotInfo.msg for the robots with the following IDs: [&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="k">if</span> <span class="n">robot</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>            <span class="nb">id</span> <span class="o">+=</span><span class="mi">1</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        **Main function**: creates the CONTROLLER and runs the ros2 node in a while loop. </span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        While loop is runnning as long as the ros2 node **mapf_evaluator_node** exists.  </span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        Every loop cycle the ros2 node is spinned for a defined period (default: 0.1sec) so it can process all data.  </span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        &gt;   1) At the beginning of every cycle CONTROLLER finds itself in the state MODE_INIT.  </span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        &gt;    2) CONTROLLER changes it&#39;s state to MODE_WAIT_SIM after a MapInfo.msg is arrived   </span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        &gt;    3) CONTROLLER moves to the state MODE_PUB_INSTANCE after receiving all needed data</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        (RobotInfo.msg for every robot in the map).    </span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        &gt;    4) After generating and publishing the instance (which can be solved by a pathplanner) </span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">            CONTROLLER waits for the solution (state: MODE_WAIT_SOLVER).      </span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        &gt;    5) After receiving a solution from a pathplanner CONTROLLER generates actions for the robots</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">            (state: MODE_PUB_SIM). After sending the actions to the SIMULATION the CONTROLLER </span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">            goes back to the initial state MODE_INIT.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="n">controller</span> <span class="o">=</span> <span class="n">Controller</span><span class="p">()</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>    <span class="c1">#spin ros for 0.1seconds</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>    <span class="c1">#time_spin = 2.0</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="n">time_spin</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="c1">#after publishing the MAPFInstance message to the solver wait for the solution</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="c1">#if after the given timeout no solution received from the solver then publish the MAPFInstance messsage again</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="n">timeout_pub_instance</span> <span class="o">=</span> <span class="mf">60.0</span>  
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STATE: Waiting for the MapInfo.msg to the topic /mapf_map_info&quot;</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="k">while</span><span class="p">(</span><span class="n">rclpy</span><span class="o">.</span><span class="n">ok</span><span class="p">()):</span>            
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;; STATE of the CONTROLLER: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span><span class="p">))</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="c1">#spin ros2 for a certain time to get all the messages</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="n">timeout_spin</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">time_spin</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">&lt;</span><span class="n">timeout_spin</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="c1">#STATE 0: wait till a MapInfo.msg received    </span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_INIT</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_INIT - Waiting for MapInfo.msg to the topic /mapf_map_info&quot;</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">_map_received</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_WAIT_SIM</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                <span class="k">continue</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>    
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="c1">#STATE 1: wait till all RobotInfo.msg received    </span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_WAIT_SIM</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_WAIT_SIM - Waiting for all RobotInfo.msg to the topic /mapf_robot_info_X where X = ID of the robot&quot;</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">check_init_robots</span><span class="p">():</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">controller</span><span class="o">.</span><span class="n">all_agents_at_target</span><span class="p">():</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                    <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_PUB_INSTANCE</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: All robots have already reached their target, return to STATE 0&quot;</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                    <span class="k">continue</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">print_missing_robot_info</span><span class="p">()</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>                <span class="k">continue</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="c1">#STATE 2: create and publish a MAPFInstance.msg (composed of MapInfo.msg and all RobotInfo.msg)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_PUB_INSTANCE</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_PUB_INSTANCE - Create and publish a MAPFInstance.msg to the topic /mapf_instance_info&quot;</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">publish_instance_msg</span><span class="p">()</span>                
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_WAIT_SOLVER</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="n">time_repeat</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout_pub_instance</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="c1">#STATE 3: wait till a MAPFSolution.msg received)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_WAIT_SOLVER</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_WAIT_SOLVER - Waiting for solution from pathplanner&quot;</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>            
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_PUB_SIM</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="c1">#if after 30sec no answer received from solver then go back to STATE 2 (pub MAPFInstance.msg again)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">&gt;</span><span class="n">time_repeat</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_PUB_INSTANCE</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="c1">#STATE 4: create and publish RobotAction.msg for the simulation</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_PUB_SIM</span><span class="p">:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_PUB_SIM - Create and publish RobotAction.msg for every robot&quot;</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">publish_action_msg</span><span class="p">(</span><span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">publish_statistics_msg</span><span class="p">(</span><span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span>               
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>    <span class="c1">#end while loop</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">run</span><span class="p">())</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="w">    </span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;&#39;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">    def msg_changed_map(self, msg):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">        if self._map_msg != msg:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">            return True</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        return False        </span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">    def clear(self):</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        self.publishers_robot = []</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">        self.subscribers_robot = []</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        self._map_msg = None    #MapInfo.msg</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        self._robot_msgs = []   #list of RobotInfo.msg</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        self._instance_msg = None</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        self._solution_msgs = []#list of MAPFSolution.msg</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        #flag if MapInfo.msg already received, so Map is initialised</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        self._map_received = False</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        #list of flags for every robot</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        #if RobotInfo message received for the robot with ID, then list[ID-1]=True</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        #self._robots_received = [] #Notice: ID starts with 1 while list with 0!        </span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        #self._solutions_received = []</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        self.ctrl_state = MODE_INIT</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        def callback_mapinfo(self, msg):</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">    </span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        #if already received a MapInfo.msg and the new message is not different from the old one, then return</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        if self._map_received and not self.msg_changed_map(msg):</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">            return        </span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        #reset previous data </span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">        self.clear()</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        self._map_msg = msg</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">        for i in range (0, msg.number_robots):</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">            subscriber = self.create_subscription(RobotInfo, &#39;mapf_robot_info_&#39; + str(i+1),</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">                                                    self.callback_robotinfo, 1)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">            self.subscribers_robot.append(subscriber)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">            publisher = self.create_publisher(RobotAction, &#39;mapf_robot_action_&#39; + str(i+1), 1)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">            self.publishers_robot.append(publisher)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        self._robot_init = [False]*len(self.subscribers_robot)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        self._robot_msgs = [None]*len(self.subscribers_robot)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        self._map_received = True</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span></pre></div>


            </section>
                <section id="MODE_INIT">
                    <div class="attr variable">
            <span class="name">MODE_INIT</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#MODE_INIT"></a>
    
            <div class="docstring"><p>= state of the module CONTROLLER at the begin of every cycle till a "mapf_interfaces/MapInfo.msg" has been received.</p>
</div>


                </section>
                <section id="MODE_WAIT_SIM">
                    <div class="attr variable">
            <span class="name">MODE_WAIT_SIM</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#MODE_WAIT_SIM"></a>
    
            <div class="docstring"><p>= state of CONTROLLER after a "mapf_interfaces/MapInfo.msg" (for the current cycle) has been received. </p>

<p>CONTROLLER checks whether the number of the robots in the 
simulation has changed and (if necessary) creates additional subscribers and publishers for new robots. 
After CONTROLLER is waiting until it has received a message of type 
"mapf_interfaces/RobotInfo.msg" from every robot in the simulation.</p>
</div>


                </section>
                <section id="MODE_PUB_INSTANCE">
                    <div class="attr variable">
            <span class="name">MODE_PUB_INSTANCE</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#MODE_PUB_INSTANCE"></a>
    
            <div class="docstring"><p>= state of CONTROLLER after it has received all necessary information from the simulation for the current cycle. </p>

<p>CONTROLLER fuses all received information to create an Instance ("mapf_interfaces/MAPFInstance.msg") which can be solved by a pathplanner</p>
</div>


                </section>
                <section id="MODE_WAIT_SOLVER">
                    <div class="attr variable">
            <span class="name">MODE_WAIT_SOLVER</span>        =
<span class="default_value">3</span>

        
    </div>
    <a class="headerlink" href="#MODE_WAIT_SOLVER"></a>
    
            <div class="docstring"><p>= state of CONTROLLER after it has published the generated Instance and waits for the solution from the pathplanner</p>
</div>


                </section>
                <section id="MODE_PUB_SIM">
                    <div class="attr variable">
            <span class="name">MODE_PUB_SIM</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#MODE_PUB_SIM"></a>
    
            <div class="docstring"><p>= state of CONTROLLER after it has received a solution from the pathplanner. </p>

<p>CONTROLLER generates the next action for every robot so they can follow the defined paths by the pathplanner.
In addition CONTROLLER generates a "mapf_interfaces/StatisticInfo.msg" for every received solution for the modul EVALUATOR</p>
</div>


                </section>
                <section id="Controller">
                            <input id="Controller-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Controller</span><wbr>(<span class="base">rclpy.node.Node</span>):

                <label class="view-source-button" for="Controller-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller-41"><a href="#Controller-41"><span class="linenos"> 41</span></a><span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="Controller-42"><a href="#Controller-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-43"><a href="#Controller-43"><span class="linenos"> 43</span></a><span class="sd">    This class represents the following ros2 node: **mapf_controller_node**.  </span>
</span><span id="Controller-44"><a href="#Controller-44"><span class="linenos"> 44</span></a>
</span><span id="Controller-45"><a href="#Controller-45"><span class="linenos"> 45</span></a><span class="sd">    The node mapf_controller_node subscribes to the folllowing topics:  </span>
</span><span id="Controller-46"><a href="#Controller-46"><span class="linenos"> 46</span></a><span class="sd">    **/mapf_map_info** *[mapf_interfaces/MapInfo.msg]*, callback_mapinfo(self, msg)  </span>
</span><span id="Controller-47"><a href="#Controller-47"><span class="linenos"> 47</span></a><span class="sd">    **/mapf_instance_solution** *[mapf_interfaces/MAPFSolution.msg]*, callback_solution(self, msg)</span>
</span><span id="Controller-48"><a href="#Controller-48"><span class="linenos"> 48</span></a>
</span><span id="Controller-49"><a href="#Controller-49"><span class="linenos"> 49</span></a><span class="sd">    The node mapf_controller_node publishes to the folllowing topics:  </span>
</span><span id="Controller-50"><a href="#Controller-50"><span class="linenos"> 50</span></a><span class="sd">    **/mapf_instance_info** *[mapf_interfaces/MAPFInstance.msg]*  </span>
</span><span id="Controller-51"><a href="#Controller-51"><span class="linenos"> 51</span></a><span class="sd">    **/mapf_statistics_info** *[mapf_interfaces/StatisticInfo.msg]*  </span>
</span><span id="Controller-52"><a href="#Controller-52"><span class="linenos"> 52</span></a>
</span><span id="Controller-53"><a href="#Controller-53"><span class="linenos"> 53</span></a><span class="sd">    For every robot in the simulation an additional subscriber and publisher will be created</span>
</span><span id="Controller-54"><a href="#Controller-54"><span class="linenos"> 54</span></a><span class="sd">    (the ID in the topic name will be replaced by the ID of the robot):  </span>
</span><span id="Controller-55"><a href="#Controller-55"><span class="linenos"> 55</span></a><span class="sd">    **/mapf_robot_info_ID** *[mapf_interfaces/RobotInfo.msg]*, callback_robotinfo(self, msg)  </span>
</span><span id="Controller-56"><a href="#Controller-56"><span class="linenos"> 56</span></a><span class="sd">    **/mapf_robot_action_ID***[mapf_interfaces/RobotAction.msg]*</span>
</span><span id="Controller-57"><a href="#Controller-57"><span class="linenos"> 57</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="Controller-58"><a href="#Controller-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller-59"><a href="#Controller-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-60"><a href="#Controller-60"><span class="linenos"> 60</span></a><span class="sd">        Creates an instance of the controller</span>
</span><span id="Controller-61"><a href="#Controller-61"><span class="linenos"> 61</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-62"><a href="#Controller-62"><span class="linenos"> 62</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;mapf_controller_node&#39;</span><span class="p">)</span>
</span><span id="Controller-63"><a href="#Controller-63"><span class="linenos"> 63</span></a>
</span><span id="Controller-64"><a href="#Controller-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span> 
</span><span id="Controller-65"><a href="#Controller-65"><span class="linenos"> 65</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the current state of the controller. Possible values are: </span>
</span><span id="Controller-66"><a href="#Controller-66"><span class="linenos"> 66</span></a><span class="sd">        &gt;MODE_INIT = 0  </span>
</span><span id="Controller-67"><a href="#Controller-67"><span class="linenos"> 67</span></a><span class="sd">        &gt;MODE_WAIT_SIM = 1  </span>
</span><span id="Controller-68"><a href="#Controller-68"><span class="linenos"> 68</span></a><span class="sd">        &gt;MODE_PUB_INSTANCE = 2  </span>
</span><span id="Controller-69"><a href="#Controller-69"><span class="linenos"> 69</span></a><span class="sd">        &gt;MODE_WAIT_SOLVER = 3   </span>
</span><span id="Controller-70"><a href="#Controller-70"><span class="linenos"> 70</span></a><span class="sd">        &gt;MODE_PUB_SIM = 4</span>
</span><span id="Controller-71"><a href="#Controller-71"><span class="linenos"> 71</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-72"><a href="#Controller-72"><span class="linenos"> 72</span></a>        
</span><span id="Controller-73"><a href="#Controller-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Controller-74"><a href="#Controller-74"><span class="linenos"> 74</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the current cylce. Each cycle has a unique id which is incrementing with every new cycle. &#39;&#39;&#39;</span>
</span><span id="Controller-75"><a href="#Controller-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Controller-76"><a href="#Controller-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the number of robots for which the connection between the CONTROLLER and SIMULATION is created&#39;&#39;&#39;</span>
</span><span id="Controller-77"><a href="#Controller-77"><span class="linenos"> 77</span></a>        
</span><span id="Controller-78"><a href="#Controller-78"><span class="linenos"> 78</span></a>        <span class="c1">#subscribe to &quot;mapf_map_info&quot; [MapInfo.msg]</span>
</span><span id="Controller-79"><a href="#Controller-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscriber_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">MapInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_map_info&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_mapinfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller-80"><a href="#Controller-80"><span class="linenos"> 80</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.subscription.Subscription** - ros2 subscriber to the topic */mapf_map_info*&#39;&#39;&#39;</span>
</span><span id="Controller-81"><a href="#Controller-81"><span class="linenos"> 81</span></a>        
</span><span id="Controller-82"><a href="#Controller-82"><span class="linenos"> 82</span></a>        <span class="c1">#list of subscribers to &quot;mapf_robot_info_ID&quot; [RobotInfo.msg]</span>
</span><span id="Controller-83"><a href="#Controller-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller-84"><a href="#Controller-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;list of objects of type **rclpy.subscription.Subscription** - subscribers to the topics: /mapf_robot_info_&quot;ID&quot;&#39;&#39;&#39;</span>
</span><span id="Controller-85"><a href="#Controller-85"><span class="linenos"> 85</span></a>        
</span><span id="Controller-86"><a href="#Controller-86"><span class="linenos"> 86</span></a>        <span class="c1">#list of publisher to &quot;mapf_robot_action_id&quot; [RobotAction.msg]</span>
</span><span id="Controller-87"><a href="#Controller-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller-88"><a href="#Controller-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;list of objects of type **rclpy.publisher.Publisher** - publishers to the topics:   </span>
</span><span id="Controller-89"><a href="#Controller-89"><span class="linenos"> 89</span></a><span class="sd">        /mapf_robot_action_&quot;ID&quot;&#39;&#39;&#39;</span>
</span><span id="Controller-90"><a href="#Controller-90"><span class="linenos"> 90</span></a>        
</span><span id="Controller-91"><a href="#Controller-91"><span class="linenos"> 91</span></a>        <span class="c1">#publish Instance to &quot;mapf_instance_info&quot; [MAPFInstance.msg]</span>
</span><span id="Controller-92"><a href="#Controller-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">MAPFInstance</span><span class="p">,</span> <span class="s1">&#39;mapf_instance_info&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller-93"><a href="#Controller-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.publisher.Publisher** - ros2 publisher to the topic */mapf_instance_info*&#39;&#39;&#39;</span>
</span><span id="Controller-94"><a href="#Controller-94"><span class="linenos"> 94</span></a>        
</span><span id="Controller-95"><a href="#Controller-95"><span class="linenos"> 95</span></a>        <span class="c1">#subscribe to &quot;mapf_instance_solution&quot; [MAPFSolution.msg]</span>
</span><span id="Controller-96"><a href="#Controller-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscriber_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">MAPFSolution</span><span class="p">,</span> <span class="s1">&#39;mapf_instance_solution&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_solution</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller-97"><a href="#Controller-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.subscription.Subscription** - ros2 subscriber to the topic */mapf_instance_solution*&#39;&#39;&#39;</span>
</span><span id="Controller-98"><a href="#Controller-98"><span class="linenos"> 98</span></a>        
</span><span id="Controller-99"><a href="#Controller-99"><span class="linenos"> 99</span></a>        <span class="c1">#publish  to &quot;mapf_statistics_info&quot; [StatisticInfo.msg]</span>
</span><span id="Controller-100"><a href="#Controller-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">StatisticInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_statistics_info&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller-101"><a href="#Controller-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.publisher.Publisher** - ros2 publisher to the topic */mapf_statistics_info*&#39;&#39;&#39;</span>
</span><span id="Controller-102"><a href="#Controller-102"><span class="linenos">102</span></a>        
</span><span id="Controller-103"><a href="#Controller-103"><span class="linenos">103</span></a>        <span class="c1">#save incoming msg here  </span>
</span><span id="Controller-104"><a href="#Controller-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#MapInfo.msg</span>
</span><span id="Controller-105"><a href="#Controller-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#list of RobotInfo.msg</span>
</span><span id="Controller-106"><a href="#Controller-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Controller-107"><a href="#Controller-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#list of MAPFSolution.msg</span>
</span><span id="Controller-108"><a href="#Controller-108"><span class="linenos">108</span></a>
</span><span id="Controller-109"><a href="#Controller-109"><span class="linenos">109</span></a>        <span class="c1">#flag if MapInfo.msg already received, so Map is initialised</span>
</span><span id="Controller-110"><a href="#Controller-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Controller-111"><a href="#Controller-111"><span class="linenos">111</span></a>        <span class="c1">#list of flags for every robot</span>
</span><span id="Controller-112"><a href="#Controller-112"><span class="linenos">112</span></a>        <span class="c1">#if RobotInfo message received for the robot with ID, then list[ID-1]=True</span>
</span><span id="Controller-113"><a href="#Controller-113"><span class="linenos">113</span></a>        <span class="c1">#self._robots_received = [] #Notice: ID starts with 1 while list with 0!        </span>
</span><span id="Controller-114"><a href="#Controller-114"><span class="linenos">114</span></a>        <span class="c1">#self._solutions_received = []</span>
</span><span id="Controller-115"><a href="#Controller-115"><span class="linenos">115</span></a>        
</span><span id="Controller-116"><a href="#Controller-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">callback_mapinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="Controller-117"><a href="#Controller-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-118"><a href="#Controller-118"><span class="linenos">118</span></a><span class="sd">        This function will be called every time a message on the topic is received: */mapf_map_info*</span>
</span><span id="Controller-119"><a href="#Controller-119"><span class="linenos">119</span></a>
</span><span id="Controller-120"><a href="#Controller-120"><span class="linenos">120</span></a><span class="sd">        If the number of the robots has not changed since the last time this function has been called </span>
</span><span id="Controller-121"><a href="#Controller-121"><span class="linenos">121</span></a><span class="sd">        then:</span>
</span><span id="Controller-122"><a href="#Controller-122"><span class="linenos">122</span></a><span class="sd">        &gt;1) set the init flags for every robot to FALSE (meaning the robot is not ready yet)   </span>
</span><span id="Controller-123"><a href="#Controller-123"><span class="linenos">123</span></a><span class="sd">        &gt;2) delete all old messages received for the robots on the following topics: */mapf_robot_info_&quot;ID&quot;*</span>
</span><span id="Controller-124"><a href="#Controller-124"><span class="linenos">124</span></a><span class="sd">        </span>
</span><span id="Controller-125"><a href="#Controller-125"><span class="linenos">125</span></a><span class="sd">        If the number of the robots has changed since the last time this function has been called then:   </span>
</span><span id="Controller-126"><a href="#Controller-126"><span class="linenos">126</span></a><span class="sd">        (this is although TRUE if this function is beeing called for the first time)</span>
</span><span id="Controller-127"><a href="#Controller-127"><span class="linenos">127</span></a><span class="sd">        &gt;1) delete old Subscribers for the topics: */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="Controller-128"><a href="#Controller-128"><span class="linenos">128</span></a><span class="sd">            delete old Publishers for the topics: */mapf_robot_action_&quot;ID&quot;*  </span>
</span><span id="Controller-129"><a href="#Controller-129"><span class="linenos">129</span></a><span class="sd">            </span>
</span><span id="Controller-130"><a href="#Controller-130"><span class="linenos">130</span></a><span class="sd">        &gt;2) for every robot create a Publisher and Subscriber  </span>
</span><span id="Controller-131"><a href="#Controller-131"><span class="linenos">131</span></a><span class="sd">        (Publisher for */mapf_robot_info_&quot;ID&quot;* and Subscriber for */mapf_robot_action_&quot;ID&quot;*)</span>
</span><span id="Controller-132"><a href="#Controller-132"><span class="linenos">132</span></a><span class="sd">        </span>
</span><span id="Controller-133"><a href="#Controller-133"><span class="linenos">133</span></a><span class="sd">        &gt;3) set the init flags for every robot to FALSE (meaning the robot is not ready yet)   </span>
</span><span id="Controller-134"><a href="#Controller-134"><span class="linenos">134</span></a><span class="sd">        </span>
</span><span id="Controller-135"><a href="#Controller-135"><span class="linenos">135</span></a><span class="sd">        &gt;4) delete all old messages received for the robots on the following topics:   </span>
</span><span id="Controller-136"><a href="#Controller-136"><span class="linenos">136</span></a><span class="sd">           &gt;&gt; */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="Controller-137"><a href="#Controller-137"><span class="linenos">137</span></a><span class="sd">           &gt;&gt; */mapf_instance_info_&quot;ID&quot;*  </span>
</span><span id="Controller-138"><a href="#Controller-138"><span class="linenos">138</span></a><span class="sd">           &gt;&gt; */mapf_instance_solution_&quot;ID&quot;*  </span>
</span><span id="Controller-139"><a href="#Controller-139"><span class="linenos">139</span></a><span class="sd">        </span>
</span><span id="Controller-140"><a href="#Controller-140"><span class="linenos">140</span></a><span class="sd">        :param msg: mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</span>
</span><span id="Controller-141"><a href="#Controller-141"><span class="linenos">141</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-142"><a href="#Controller-142"><span class="linenos">142</span></a>
</span><span id="Controller-143"><a href="#Controller-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span><span id="Controller-144"><a href="#Controller-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span>
</span><span id="Controller-145"><a href="#Controller-145"><span class="linenos">145</span></a>        
</span><span id="Controller-146"><a href="#Controller-146"><span class="linenos">146</span></a>        <span class="c1">#save the received msg</span>
</span><span id="Controller-147"><a href="#Controller-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="Controller-148"><a href="#Controller-148"><span class="linenos">148</span></a>        <span class="c1">#mark that map message has already been received</span>
</span><span id="Controller-149"><a href="#Controller-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Controller-150"><a href="#Controller-150"><span class="linenos">150</span></a>        
</span><span id="Controller-151"><a href="#Controller-151"><span class="linenos">151</span></a>        <span class="c1">#if the number of robots from last time hasn&#39;t changed then</span>
</span><span id="Controller-152"><a href="#Controller-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_robots_changed</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
</span><span id="Controller-153"><a href="#Controller-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="Controller-154"><a href="#Controller-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="Controller-155"><a href="#Controller-155"><span class="linenos">155</span></a>            <span class="k">return</span>
</span><span id="Controller-156"><a href="#Controller-156"><span class="linenos">156</span></a>        
</span><span id="Controller-157"><a href="#Controller-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clear_robots</span><span class="p">()</span>
</span><span id="Controller-158"><a href="#Controller-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span>
</span><span id="Controller-159"><a href="#Controller-159"><span class="linenos">159</span></a>        
</span><span id="Controller-160"><a href="#Controller-160"><span class="linenos">160</span></a>        <span class="c1">#create publisher[RobotAction.msg] and subscriber[RobotInfo.msg] for every robot</span>
</span><span id="Controller-161"><a href="#Controller-161"><span class="linenos">161</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span><span class="p">):</span>
</span><span id="Controller-162"><a href="#Controller-162"><span class="linenos">162</span></a>            <span class="c1">#create subscriber</span>
</span><span id="Controller-163"><a href="#Controller-163"><span class="linenos">163</span></a>            <span class="n">subscriber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">RobotInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_robot_info_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
</span><span id="Controller-164"><a href="#Controller-164"><span class="linenos">164</span></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">callback_robotinfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller-165"><a href="#Controller-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
</span><span id="Controller-166"><a href="#Controller-166"><span class="linenos">166</span></a>            <span class="c1">#create publisher</span>
</span><span id="Controller-167"><a href="#Controller-167"><span class="linenos">167</span></a>            <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">RobotAction</span><span class="p">,</span> <span class="s1">&#39;mapf_robot_action_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller-168"><a href="#Controller-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">publisher</span><span class="p">)</span>
</span><span id="Controller-169"><a href="#Controller-169"><span class="linenos">169</span></a>
</span><span id="Controller-170"><a href="#Controller-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="Controller-171"><a href="#Controller-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="Controller-172"><a href="#Controller-172"><span class="linenos">172</span></a>
</span><span id="Controller-173"><a href="#Controller-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">callback_robotinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>    
</span><span id="Controller-174"><a href="#Controller-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-175"><a href="#Controller-175"><span class="linenos">175</span></a><span class="sd">        This function will be called every time a message on the following topics is received: */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="Controller-176"><a href="#Controller-176"><span class="linenos">176</span></a>
</span><span id="Controller-177"><a href="#Controller-177"><span class="linenos">177</span></a><span class="sd">        CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle.   </span>
</span><span id="Controller-178"><a href="#Controller-178"><span class="linenos">178</span></a><span class="sd">        If the numbers are not equal, then the information in the message is old and will be ignored.  </span>
</span><span id="Controller-179"><a href="#Controller-179"><span class="linenos">179</span></a><span class="sd">        If the numbers are equal then, the CONTROLLER saves the message and sets the INIT-flag for the corresponding robot to TRUE!  </span>
</span><span id="Controller-180"><a href="#Controller-180"><span class="linenos">180</span></a>
</span><span id="Controller-181"><a href="#Controller-181"><span class="linenos">181</span></a><span class="sd">        :param msg: mapf_interfaces/RobotInfo.msg - message from the topic /mapf_robot_info_ID</span>
</span><span id="Controller-182"><a href="#Controller-182"><span class="linenos">182</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-183"><a href="#Controller-183"><span class="linenos">183</span></a>
</span><span id="Controller-184"><a href="#Controller-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">:</span>
</span><span id="Controller-185"><a href="#Controller-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RobotInfo.msg received, but with an old ID = </span><span class="si">%d</span><span class="s2">. Skip the message&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller-186"><a href="#Controller-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;msg.id = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller-187"><a href="#Controller-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;self.current_id_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">)</span>
</span><span id="Controller-188"><a href="#Controller-188"><span class="linenos">188</span></a>            <span class="k">return</span>    
</span><span id="Controller-189"><a href="#Controller-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Controller-190"><a href="#Controller-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="Controller-191"><a href="#Controller-191"><span class="linenos">191</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialising ROBOT with ID: &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="p">)</span>    
</span><span id="Controller-192"><a href="#Controller-192"><span class="linenos">192</span></a>
</span><span id="Controller-193"><a href="#Controller-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">callback_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="Controller-194"><a href="#Controller-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-195"><a href="#Controller-195"><span class="linenos">195</span></a><span class="sd">        This function will be called every time a message on the following topics is received: */mapf_instance_solution*  </span>
</span><span id="Controller-196"><a href="#Controller-196"><span class="linenos">196</span></a>
</span><span id="Controller-197"><a href="#Controller-197"><span class="linenos">197</span></a><span class="sd">        CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle.   </span>
</span><span id="Controller-198"><a href="#Controller-198"><span class="linenos">198</span></a><span class="sd">        If the numbers are not equal, then the information in the message is old and will be ignored.  </span>
</span><span id="Controller-199"><a href="#Controller-199"><span class="linenos">199</span></a><span class="sd">        If the numbers are equal, then the CONTROLLER saves the message/solution.</span>
</span><span id="Controller-200"><a href="#Controller-200"><span class="linenos">200</span></a>
</span><span id="Controller-201"><a href="#Controller-201"><span class="linenos">201</span></a><span class="sd">        :param msg: mapf_interfaces/MAPFSolution.msg - message from the topic /mapf_instance_solution</span>
</span><span id="Controller-202"><a href="#Controller-202"><span class="linenos">202</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-203"><a href="#Controller-203"><span class="linenos">203</span></a>        
</span><span id="Controller-204"><a href="#Controller-204"><span class="linenos">204</span></a>        <span class="c1">#skip solutions for old instances </span>
</span><span id="Controller-205"><a href="#Controller-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">:</span>
</span><span id="Controller-206"><a href="#Controller-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAPFSolution.msg received, but with an old ID = </span><span class="si">%d</span><span class="s2">. Skip the message&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller-207"><a href="#Controller-207"><span class="linenos">207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;msg.id = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller-208"><a href="#Controller-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;self.current_id_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">)</span>
</span><span id="Controller-209"><a href="#Controller-209"><span class="linenos">209</span></a>            <span class="k">return</span>
</span><span id="Controller-210"><a href="#Controller-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAPFSolution.msg received, ID = </span><span class="si">%d</span><span class="s2">, STEP: </span><span class="si">%d</span><span class="s2">, algorithm: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">name_algorithm</span><span class="p">))</span>                              
</span><span id="Controller-211"><a href="#Controller-211"><span class="linenos">211</span></a>        <span class="c1">#self._solution_msgs.append(msg)</span>
</span><span id="Controller-212"><a href="#Controller-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="Controller-213"><a href="#Controller-213"><span class="linenos">213</span></a>        
</span><span id="Controller-214"><a href="#Controller-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">publish_instance_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller-215"><a href="#Controller-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-216"><a href="#Controller-216"><span class="linenos">216</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/MAPFInstance.msg] and publishes it to the following topic: */mapf_instance_info*  </span>
</span><span id="Controller-217"><a href="#Controller-217"><span class="linenos">217</span></a>
</span><span id="Controller-218"><a href="#Controller-218"><span class="linenos">218</span></a><span class="sd">        The message will be generated by fusing the information from the arrived messages on the following topics:  </span>
</span><span id="Controller-219"><a href="#Controller-219"><span class="linenos">219</span></a><span class="sd">        */mapf_map_info* [mapf_interfaces/MapInfo.msg] and   </span>
</span><span id="Controller-220"><a href="#Controller-220"><span class="linenos">220</span></a><span class="sd">        */mapf_robot_info_ID* [mapf_interfaces/RobotInfo.msg] for every robot </span>
</span><span id="Controller-221"><a href="#Controller-221"><span class="linenos">221</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-222"><a href="#Controller-222"><span class="linenos">222</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">MAPFInstance</span><span class="p">()</span>
</span><span id="Controller-223"><a href="#Controller-223"><span class="linenos">223</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span>
</span><span id="Controller-224"><a href="#Controller-224"><span class="linenos">224</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span><span class="o">.</span><span class="n">step</span>
</span><span id="Controller-225"><a href="#Controller-225"><span class="linenos">225</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span>
</span><span id="Controller-226"><a href="#Controller-226"><span class="linenos">226</span></a>        <span class="k">for</span> <span class="n">robot_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">:</span>
</span><span id="Controller-227"><a href="#Controller-227"><span class="linenos">227</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_msg</span><span class="p">)</span>
</span><span id="Controller-228"><a href="#Controller-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_instance</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Controller-229"><a href="#Controller-229"><span class="linenos">229</span></a>        <span class="c1">#save the published message for later to check with corresponding answer</span>
</span><span id="Controller-230"><a href="#Controller-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="Controller-231"><a href="#Controller-231"><span class="linenos">231</span></a>        <span class="c1">#delete all solutions for an older instance!!!!</span>
</span><span id="Controller-232"><a href="#Controller-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller-233"><a href="#Controller-233"><span class="linenos">233</span></a>
</span><span id="Controller-234"><a href="#Controller-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">publish_action_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>         
</span><span id="Controller-235"><a href="#Controller-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-236"><a href="#Controller-236"><span class="linenos">236</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/RobotAction.msg] and publishes it to the following topic: */mapf_robot_action_ID*  </span>
</span><span id="Controller-237"><a href="#Controller-237"><span class="linenos">237</span></a><span class="sd">        </span>
</span><span id="Controller-238"><a href="#Controller-238"><span class="linenos">238</span></a><span class="sd">        The message will be generated from the received solution by the pathplanner: */mapf_solution_info* [mapf_interfaces/MAPFSolution.msg].  </span>
</span><span id="Controller-239"><a href="#Controller-239"><span class="linenos">239</span></a><span class="sd">        The solution defines the paths for every robot. Every path is defined by a set of points. The action for every robot will be defined by the difference </span>
</span><span id="Controller-240"><a href="#Controller-240"><span class="linenos">240</span></a><span class="sd">        between the first two points from their path.</span>
</span><span id="Controller-241"><a href="#Controller-241"><span class="linenos">241</span></a><span class="sd">        The first point in the path describes the actual position of the robot, the second point the next target point from the path.</span>
</span><span id="Controller-242"><a href="#Controller-242"><span class="linenos">242</span></a><span class="sd">        </span>
</span><span id="Controller-243"><a href="#Controller-243"><span class="linenos">243</span></a><span class="sd">        :param int: solution_number - defines which solution should be used for generating the actions for the robot  </span>
</span><span id="Controller-244"><a href="#Controller-244"><span class="linenos">244</span></a><span class="sd">        (at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one </span>
</span><span id="Controller-245"><a href="#Controller-245"><span class="linenos">245</span></a><span class="sd">        solution and choose the best one of those. For that matter it should be possible to define which solution should be used here)</span>
</span><span id="Controller-246"><a href="#Controller-246"><span class="linenos">246</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-247"><a href="#Controller-247"><span class="linenos">247</span></a>        <span class="k">for</span> <span class="n">pathInfoMsg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">[</span><span class="n">solution_number</span><span class="p">]</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
</span><span id="Controller-248"><a href="#Controller-248"><span class="linenos">248</span></a>        <span class="c1">#for pathInfoMsg in self.solution_msg.paths:</span>
</span><span id="Controller-249"><a href="#Controller-249"><span class="linenos">249</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">RobotAction</span><span class="p">()</span>
</span><span id="Controller-250"><a href="#Controller-250"><span class="linenos">250</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span>
</span><span id="Controller-251"><a href="#Controller-251"><span class="linenos">251</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">step</span>
</span><span id="Controller-252"><a href="#Controller-252"><span class="linenos">252</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">robot_id</span>
</span><span id="Controller-253"><a href="#Controller-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Controller-254"><a href="#Controller-254"><span class="linenos">254</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Controller-255"><a href="#Controller-255"><span class="linenos">255</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Controller-256"><a href="#Controller-256"><span class="linenos">256</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Controller-257"><a href="#Controller-257"><span class="linenos">257</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Controller-258"><a href="#Controller-258"><span class="linenos">258</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_x</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_x</span>
</span><span id="Controller-259"><a href="#Controller-259"><span class="linenos">259</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_y</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_y</span>
</span><span id="Controller-260"><a href="#Controller-260"><span class="linenos">260</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span>
</span><span id="Controller-261"><a href="#Controller-261"><span class="linenos">261</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span>
</span><span id="Controller-262"><a href="#Controller-262"><span class="linenos">262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Controller-263"><a href="#Controller-263"><span class="linenos">263</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
</span><span id="Controller-264"><a href="#Controller-264"><span class="linenos">264</span></a>                      
</span><span id="Controller-265"><a href="#Controller-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">publish_statistics_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Controller-266"><a href="#Controller-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-267"><a href="#Controller-267"><span class="linenos">267</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/StatisticInfo.msg]</span>
</span><span id="Controller-268"><a href="#Controller-268"><span class="linenos">268</span></a><span class="sd">        and publishes it to the following topic: */mapf_statistics_info*  </span>
</span><span id="Controller-269"><a href="#Controller-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="Controller-270"><a href="#Controller-270"><span class="linenos">270</span></a><span class="sd">        The content for the message can be extracted directly from the saved solution (MAPFSolution.msg).</span>
</span><span id="Controller-271"><a href="#Controller-271"><span class="linenos">271</span></a>
</span><span id="Controller-272"><a href="#Controller-272"><span class="linenos">272</span></a><span class="sd">        :param int: solution_number - defines which solution should be used for generating the message  </span>
</span><span id="Controller-273"><a href="#Controller-273"><span class="linenos">273</span></a><span class="sd">        (at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one </span>
</span><span id="Controller-274"><a href="#Controller-274"><span class="linenos">274</span></a><span class="sd">        solution and choose the best one of those. For that matter it should be possible to define here which solution should be used)</span>
</span><span id="Controller-275"><a href="#Controller-275"><span class="linenos">275</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-276"><a href="#Controller-276"><span class="linenos">276</span></a>        <span class="c1">#msg = self._solution_msgs[solution_number].statistics</span>
</span><span id="Controller-277"><a href="#Controller-277"><span class="linenos">277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_statistics</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">[</span><span class="n">solution_number</span><span class="p">]</span><span class="o">.</span><span class="n">statistics</span><span class="p">)</span>
</span><span id="Controller-278"><a href="#Controller-278"><span class="linenos">278</span></a>
</span><span id="Controller-279"><a href="#Controller-279"><span class="linenos">279</span></a>    <span class="k">def</span> <span class="nf">check_init_robots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   
</span><span id="Controller-280"><a href="#Controller-280"><span class="linenos">280</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-281"><a href="#Controller-281"><span class="linenos">281</span></a><span class="sd">        This function checks whether the flag for every robot is set to TRUE. </span>
</span><span id="Controller-282"><a href="#Controller-282"><span class="linenos">282</span></a><span class="sd">        </span>
</span><span id="Controller-283"><a href="#Controller-283"><span class="linenos">283</span></a><span class="sd">        This function is used to check whether the information about all the robots</span>
</span><span id="Controller-284"><a href="#Controller-284"><span class="linenos">284</span></a><span class="sd">        has been received by the CONTROLLER from the SIMULATION.</span>
</span><span id="Controller-285"><a href="#Controller-285"><span class="linenos">285</span></a>
</span><span id="Controller-286"><a href="#Controller-286"><span class="linenos">286</span></a><span class="sd">        :return: **True**, if the flag for every robot is set to TRUE in the CONTROLLER  </span>
</span><span id="Controller-287"><a href="#Controller-287"><span class="linenos">287</span></a><span class="sd">        **False**, otherwise</span>
</span><span id="Controller-288"><a href="#Controller-288"><span class="linenos">288</span></a>
</span><span id="Controller-289"><a href="#Controller-289"><span class="linenos">289</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-290"><a href="#Controller-290"><span class="linenos">290</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Controller-291"><a href="#Controller-291"><span class="linenos">291</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Controller-292"><a href="#Controller-292"><span class="linenos">292</span></a>        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">:</span>
</span><span id="Controller-293"><a href="#Controller-293"><span class="linenos">293</span></a>            <span class="k">if</span> <span class="n">robot</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Controller-294"><a href="#Controller-294"><span class="linenos">294</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Controller-295"><a href="#Controller-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="Controller-296"><a href="#Controller-296"><span class="linenos">296</span></a>
</span><span id="Controller-297"><a href="#Controller-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">all_agents_at_target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller-298"><a href="#Controller-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-299"><a href="#Controller-299"><span class="linenos">299</span></a><span class="sd">        This function checks if all robots have visited all their checkpoints. If it is the case then all robots have reached their targets!</span>
</span><span id="Controller-300"><a href="#Controller-300"><span class="linenos">300</span></a><span class="sd">        :return: **True**, if all robots have visited all their checkpoints  </span>
</span><span id="Controller-301"><a href="#Controller-301"><span class="linenos">301</span></a><span class="sd">        **False**, otherwise</span>
</span><span id="Controller-302"><a href="#Controller-302"><span class="linenos">302</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-303"><a href="#Controller-303"><span class="linenos">303</span></a>        <span class="k">for</span> <span class="n">robot_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">:</span>
</span><span id="Controller-304"><a href="#Controller-304"><span class="linenos">304</span></a>           <span class="k">for</span> <span class="n">checkpoint_msg</span> <span class="ow">in</span> <span class="n">robot_msg</span><span class="o">.</span><span class="n">checkpoints</span><span class="p">:</span>
</span><span id="Controller-305"><a href="#Controller-305"><span class="linenos">305</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpoint_msg</span><span class="o">.</span><span class="n">visited</span><span class="p">:</span>
</span><span id="Controller-306"><a href="#Controller-306"><span class="linenos">306</span></a>                   <span class="c1">#print(&quot;CHECKPOINT NOT VISITED&quot;)</span>
</span><span id="Controller-307"><a href="#Controller-307"><span class="linenos">307</span></a>                   <span class="c1">#print(checkpoint_msg.position.pos_x)</span>
</span><span id="Controller-308"><a href="#Controller-308"><span class="linenos">308</span></a>                   <span class="c1">#print(checkpoint_msg.position.pos_y)</span>
</span><span id="Controller-309"><a href="#Controller-309"><span class="linenos">309</span></a>                   <span class="k">return</span> <span class="kc">False</span>
</span><span id="Controller-310"><a href="#Controller-310"><span class="linenos">310</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="Controller-311"><a href="#Controller-311"><span class="linenos">311</span></a>             
</span><span id="Controller-312"><a href="#Controller-312"><span class="linenos">312</span></a>    <span class="k">def</span> <span class="nf">number_robots_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="Controller-313"><a href="#Controller-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-314"><a href="#Controller-314"><span class="linenos">314</span></a><span class="sd">        This function checks whether the number of the robots has changed from the last time (last time CONTROLLER received the MapInfo.msg). </span>
</span><span id="Controller-315"><a href="#Controller-315"><span class="linenos">315</span></a><span class="sd">        </span>
</span><span id="Controller-316"><a href="#Controller-316"><span class="linenos">316</span></a><span class="sd">        :param msg: mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</span>
</span><span id="Controller-317"><a href="#Controller-317"><span class="linenos">317</span></a>
</span><span id="Controller-318"><a href="#Controller-318"><span class="linenos">318</span></a><span class="sd">        :return: **True**, if the number of the robots has changed or if the CONTROLLER has not received any MapInfo.msg so far  </span>
</span><span id="Controller-319"><a href="#Controller-319"><span class="linenos">319</span></a><span class="sd">        **False**, if the number of the robots has not changed</span>
</span><span id="Controller-320"><a href="#Controller-320"><span class="linenos">320</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-321"><a href="#Controller-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span><span class="p">:</span>
</span><span id="Controller-322"><a href="#Controller-322"><span class="linenos">322</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Controller-323"><a href="#Controller-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">!=</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span><span class="p">:</span>
</span><span id="Controller-324"><a href="#Controller-324"><span class="linenos">324</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Controller-325"><a href="#Controller-325"><span class="linenos">325</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Controller-326"><a href="#Controller-326"><span class="linenos">326</span></a>
</span><span id="Controller-327"><a href="#Controller-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">clear_robots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller-328"><a href="#Controller-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-329"><a href="#Controller-329"><span class="linenos">329</span></a><span class="sd">        This function is executing the following procedures:</span>
</span><span id="Controller-330"><a href="#Controller-330"><span class="linenos">330</span></a><span class="sd">        &gt;   1) deleting all Subscribers to and received messages on the following topics: /mapf_robot_info_&quot;ID&quot;  </span>
</span><span id="Controller-331"><a href="#Controller-331"><span class="linenos">331</span></a><span class="sd">            2) deleting all Publishers to the following topics: /mapf_robot_action_&quot;ID&quot;  </span>
</span><span id="Controller-332"><a href="#Controller-332"><span class="linenos">332</span></a><span class="sd">            3) deleting all created Instances for the pathplanners and all received solutions from the pathplanners  </span>
</span><span id="Controller-333"><a href="#Controller-333"><span class="linenos">333</span></a><span class="sd">            4) at the end resets the STATE of the CONTROLLER to MODE_INIT </span>
</span><span id="Controller-334"><a href="#Controller-334"><span class="linenos">334</span></a>
</span><span id="Controller-335"><a href="#Controller-335"><span class="linenos">335</span></a><span class="sd">        This function is called when the number of the robots has changed. In that case the old data will be deleted </span>
</span><span id="Controller-336"><a href="#Controller-336"><span class="linenos">336</span></a><span class="sd">        and a new initialisation of the CONTROLLER with the new number of robots will be carried out.</span>
</span><span id="Controller-337"><a href="#Controller-337"><span class="linenos">337</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-338"><a href="#Controller-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller-339"><a href="#Controller-339"><span class="linenos">339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller-340"><a href="#Controller-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#list of RobotInfo.msg</span>
</span><span id="Controller-341"><a href="#Controller-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Controller-342"><a href="#Controller-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#list of MAPFSolution.msg</span>
</span><span id="Controller-343"><a href="#Controller-343"><span class="linenos">343</span></a>        
</span><span id="Controller-344"><a href="#Controller-344"><span class="linenos">344</span></a>        <span class="c1">#list of flags for every robot</span>
</span><span id="Controller-345"><a href="#Controller-345"><span class="linenos">345</span></a>        <span class="c1">#if RobotInfo message received for the robot with ID, then list[ID-1]=True</span>
</span><span id="Controller-346"><a href="#Controller-346"><span class="linenos">346</span></a>        <span class="c1">#self._robots_received = [] #Notice: ID starts with 1 while list with 0!        </span>
</span><span id="Controller-347"><a href="#Controller-347"><span class="linenos">347</span></a>        <span class="c1">#self._solutions_received = []</span>
</span><span id="Controller-348"><a href="#Controller-348"><span class="linenos">348</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span><span id="Controller-349"><a href="#Controller-349"><span class="linenos">349</span></a>
</span><span id="Controller-350"><a href="#Controller-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">print_missing_robot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller-351"><a href="#Controller-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller-352"><a href="#Controller-352"><span class="linenos">352</span></a><span class="sd">        This function prints the ID-s of those robots of which the CONTROLLER is missing the information about</span>
</span><span id="Controller-353"><a href="#Controller-353"><span class="linenos">353</span></a><span class="sd">        (have not received a RobotInfo.msg for these robots with the id of the current cycle).  </span>
</span><span id="Controller-354"><a href="#Controller-354"><span class="linenos">354</span></a>
</span><span id="Controller-355"><a href="#Controller-355"><span class="linenos">355</span></a><span class="sd">        This function is used as a help-function for diagnostic purposes.</span>
</span><span id="Controller-356"><a href="#Controller-356"><span class="linenos">356</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller-357"><a href="#Controller-357"><span class="linenos">357</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing RobotInfo.msg for the robots with the following IDs: [&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Controller-358"><a href="#Controller-358"><span class="linenos">358</span></a>        <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Controller-359"><a href="#Controller-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">:</span>
</span><span id="Controller-360"><a href="#Controller-360"><span class="linenos">360</span></a>            <span class="k">if</span> <span class="n">robot</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Controller-361"><a href="#Controller-361"><span class="linenos">361</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Controller-362"><a href="#Controller-362"><span class="linenos">362</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Controller-363"><a href="#Controller-363"><span class="linenos">363</span></a>            <span class="nb">id</span> <span class="o">+=</span><span class="mi">1</span>
</span><span id="Controller-364"><a href="#Controller-364"><span class="linenos">364</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This class represents the following ros2 node: <strong>mapf_controller_node</strong>.  </p>

<p>The node mapf_controller_node subscribes to the folllowing topics: <br />
<strong>/mapf_map_info</strong> <em>[mapf_interfaces/MapInfo.msg]</em>, callback_mapinfo(self, msg) <br />
<strong>/mapf_instance_solution</strong> <em>[mapf_interfaces/MAPFSolution.msg]</em>, callback_solution(self, msg)</p>

<p>The node mapf_controller_node publishes to the folllowing topics: <br />
<strong>/mapf_instance_info</strong> <em>[mapf_interfaces/MAPFInstance.msg]</em> <br />
<strong>/mapf_statistics_info</strong> <em>[mapf_interfaces/StatisticInfo.msg]</em>  </p>

<p>For every robot in the simulation an additional subscriber and publisher will be created
(the ID in the topic name will be replaced by the ID of the robot): <br />
<strong>/mapf_robot_info_ID</strong> <em>[mapf_interfaces/RobotInfo.msg]</em>, callback_robotinfo(self, msg) <br />
<strong>/mapf_robot_action_ID<em></strong>[mapf_interfaces/RobotAction.msg]</em></p>
</div>


                            <div id="Controller.__init__" class="classattr">
                                        <input id="Controller.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Controller</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="Controller.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.__init__-58"><a href="#Controller.__init__-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller.__init__-59"><a href="#Controller.__init__-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-60"><a href="#Controller.__init__-60"><span class="linenos"> 60</span></a><span class="sd">        Creates an instance of the controller</span>
</span><span id="Controller.__init__-61"><a href="#Controller.__init__-61"><span class="linenos"> 61</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.__init__-62"><a href="#Controller.__init__-62"><span class="linenos"> 62</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;mapf_controller_node&#39;</span><span class="p">)</span>
</span><span id="Controller.__init__-63"><a href="#Controller.__init__-63"><span class="linenos"> 63</span></a>
</span><span id="Controller.__init__-64"><a href="#Controller.__init__-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span> 
</span><span id="Controller.__init__-65"><a href="#Controller.__init__-65"><span class="linenos"> 65</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the current state of the controller. Possible values are: </span>
</span><span id="Controller.__init__-66"><a href="#Controller.__init__-66"><span class="linenos"> 66</span></a><span class="sd">        &gt;MODE_INIT = 0  </span>
</span><span id="Controller.__init__-67"><a href="#Controller.__init__-67"><span class="linenos"> 67</span></a><span class="sd">        &gt;MODE_WAIT_SIM = 1  </span>
</span><span id="Controller.__init__-68"><a href="#Controller.__init__-68"><span class="linenos"> 68</span></a><span class="sd">        &gt;MODE_PUB_INSTANCE = 2  </span>
</span><span id="Controller.__init__-69"><a href="#Controller.__init__-69"><span class="linenos"> 69</span></a><span class="sd">        &gt;MODE_WAIT_SOLVER = 3   </span>
</span><span id="Controller.__init__-70"><a href="#Controller.__init__-70"><span class="linenos"> 70</span></a><span class="sd">        &gt;MODE_PUB_SIM = 4</span>
</span><span id="Controller.__init__-71"><a href="#Controller.__init__-71"><span class="linenos"> 71</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.__init__-72"><a href="#Controller.__init__-72"><span class="linenos"> 72</span></a>        
</span><span id="Controller.__init__-73"><a href="#Controller.__init__-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Controller.__init__-74"><a href="#Controller.__init__-74"><span class="linenos"> 74</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the current cylce. Each cycle has a unique id which is incrementing with every new cycle. &#39;&#39;&#39;</span>
</span><span id="Controller.__init__-75"><a href="#Controller.__init__-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Controller.__init__-76"><a href="#Controller.__init__-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**int** - defines the number of robots for which the connection between the CONTROLLER and SIMULATION is created&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-77"><a href="#Controller.__init__-77"><span class="linenos"> 77</span></a>        
</span><span id="Controller.__init__-78"><a href="#Controller.__init__-78"><span class="linenos"> 78</span></a>        <span class="c1">#subscribe to &quot;mapf_map_info&quot; [MapInfo.msg]</span>
</span><span id="Controller.__init__-79"><a href="#Controller.__init__-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscriber_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">MapInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_map_info&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_mapinfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller.__init__-80"><a href="#Controller.__init__-80"><span class="linenos"> 80</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.subscription.Subscription** - ros2 subscriber to the topic */mapf_map_info*&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-81"><a href="#Controller.__init__-81"><span class="linenos"> 81</span></a>        
</span><span id="Controller.__init__-82"><a href="#Controller.__init__-82"><span class="linenos"> 82</span></a>        <span class="c1">#list of subscribers to &quot;mapf_robot_info_ID&quot; [RobotInfo.msg]</span>
</span><span id="Controller.__init__-83"><a href="#Controller.__init__-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller.__init__-84"><a href="#Controller.__init__-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;list of objects of type **rclpy.subscription.Subscription** - subscribers to the topics: /mapf_robot_info_&quot;ID&quot;&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-85"><a href="#Controller.__init__-85"><span class="linenos"> 85</span></a>        
</span><span id="Controller.__init__-86"><a href="#Controller.__init__-86"><span class="linenos"> 86</span></a>        <span class="c1">#list of publisher to &quot;mapf_robot_action_id&quot; [RobotAction.msg]</span>
</span><span id="Controller.__init__-87"><a href="#Controller.__init__-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller.__init__-88"><a href="#Controller.__init__-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;list of objects of type **rclpy.publisher.Publisher** - publishers to the topics:   </span>
</span><span id="Controller.__init__-89"><a href="#Controller.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        /mapf_robot_action_&quot;ID&quot;&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-90"><a href="#Controller.__init__-90"><span class="linenos"> 90</span></a>        
</span><span id="Controller.__init__-91"><a href="#Controller.__init__-91"><span class="linenos"> 91</span></a>        <span class="c1">#publish Instance to &quot;mapf_instance_info&quot; [MAPFInstance.msg]</span>
</span><span id="Controller.__init__-92"><a href="#Controller.__init__-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">MAPFInstance</span><span class="p">,</span> <span class="s1">&#39;mapf_instance_info&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller.__init__-93"><a href="#Controller.__init__-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.publisher.Publisher** - ros2 publisher to the topic */mapf_instance_info*&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-94"><a href="#Controller.__init__-94"><span class="linenos"> 94</span></a>        
</span><span id="Controller.__init__-95"><a href="#Controller.__init__-95"><span class="linenos"> 95</span></a>        <span class="c1">#subscribe to &quot;mapf_instance_solution&quot; [MAPFSolution.msg]</span>
</span><span id="Controller.__init__-96"><a href="#Controller.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscriber_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">MAPFSolution</span><span class="p">,</span> <span class="s1">&#39;mapf_instance_solution&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_solution</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller.__init__-97"><a href="#Controller.__init__-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.subscription.Subscription** - ros2 subscriber to the topic */mapf_instance_solution*&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-98"><a href="#Controller.__init__-98"><span class="linenos"> 98</span></a>        
</span><span id="Controller.__init__-99"><a href="#Controller.__init__-99"><span class="linenos"> 99</span></a>        <span class="c1">#publish  to &quot;mapf_statistics_info&quot; [StatisticInfo.msg]</span>
</span><span id="Controller.__init__-100"><a href="#Controller.__init__-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">StatisticInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_statistics_info&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller.__init__-101"><a href="#Controller.__init__-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;**rclpy.publisher.Publisher** - ros2 publisher to the topic */mapf_statistics_info*&#39;&#39;&#39;</span>
</span><span id="Controller.__init__-102"><a href="#Controller.__init__-102"><span class="linenos">102</span></a>        
</span><span id="Controller.__init__-103"><a href="#Controller.__init__-103"><span class="linenos">103</span></a>        <span class="c1">#save incoming msg here  </span>
</span><span id="Controller.__init__-104"><a href="#Controller.__init__-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#MapInfo.msg</span>
</span><span id="Controller.__init__-105"><a href="#Controller.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#list of RobotInfo.msg</span>
</span><span id="Controller.__init__-106"><a href="#Controller.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Controller.__init__-107"><a href="#Controller.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#list of MAPFSolution.msg</span>
</span><span id="Controller.__init__-108"><a href="#Controller.__init__-108"><span class="linenos">108</span></a>
</span><span id="Controller.__init__-109"><a href="#Controller.__init__-109"><span class="linenos">109</span></a>        <span class="c1">#flag if MapInfo.msg already received, so Map is initialised</span>
</span><span id="Controller.__init__-110"><a href="#Controller.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Controller.__init__-111"><a href="#Controller.__init__-111"><span class="linenos">111</span></a>        <span class="c1">#list of flags for every robot</span>
</span><span id="Controller.__init__-112"><a href="#Controller.__init__-112"><span class="linenos">112</span></a>        <span class="c1">#if RobotInfo message received for the robot with ID, then list[ID-1]=True</span>
</span><span id="Controller.__init__-113"><a href="#Controller.__init__-113"><span class="linenos">113</span></a>        <span class="c1">#self._robots_received = [] #Notice: ID starts with 1 while list with 0!        </span>
</span><span id="Controller.__init__-114"><a href="#Controller.__init__-114"><span class="linenos">114</span></a>        <span class="c1">#self._solutions_received = []</span>
</span></pre></div>


            <div class="docstring"><p>Creates an instance of the controller</p>
</div>


                            </div>
                            <div id="Controller.ctrl_state" class="classattr">
                                <div class="attr variable">
            <span class="name">ctrl_state</span>

        
    </div>
    <a class="headerlink" href="#Controller.ctrl_state"></a>
    
            <div class="docstring"><p><strong>int</strong> - defines the current state of the controller. Possible values are: </p>

<blockquote>
  <p>MODE_INIT = 0 <br />
  MODE_WAIT_SIM = 1 <br />
  MODE_PUB_INSTANCE = 2 <br />
  MODE_WAIT_SOLVER = 3 <br />
  MODE_PUB_SIM = 4</p>
</blockquote>
</div>


                            </div>
                            <div id="Controller.current_id_cycle" class="classattr">
                                <div class="attr variable">
            <span class="name">current_id_cycle</span>

        
    </div>
    <a class="headerlink" href="#Controller.current_id_cycle"></a>
    
            <div class="docstring"><p><strong>int</strong> - defines the current cylce. Each cycle has a unique id which is incrementing with every new cycle.</p>
</div>


                            </div>
                            <div id="Controller.number_robots" class="classattr">
                                <div class="attr variable">
            <span class="name">number_robots</span>

        
    </div>
    <a class="headerlink" href="#Controller.number_robots"></a>
    
            <div class="docstring"><p><strong>int</strong> - defines the number of robots for which the connection between the CONTROLLER and SIMULATION is created</p>
</div>


                            </div>
                            <div id="Controller.subscriber_map" class="classattr">
                                <div class="attr variable">
            <span class="name">subscriber_map</span>

        
    </div>
    <a class="headerlink" href="#Controller.subscriber_map"></a>
    
            <div class="docstring"><p><strong>rclpy.subscription.Subscription</strong> - ros2 subscriber to the topic <em>/mapf_map_info</em></p>
</div>


                            </div>
                            <div id="Controller.subscribers_robot" class="classattr">
                                <div class="attr variable">
            <span class="name">subscribers_robot</span>

        
    </div>
    <a class="headerlink" href="#Controller.subscribers_robot"></a>
    
            <div class="docstring"><p>list of objects of type <strong>rclpy.subscription.Subscription</strong> - subscribers to the topics: /mapf_robot_info_"ID"</p>
</div>


                            </div>
                            <div id="Controller.publishers_robot" class="classattr">
                                <div class="attr variable">
            <span class="name">publishers_robot</span>

        
    </div>
    <a class="headerlink" href="#Controller.publishers_robot"></a>
    
            <div class="docstring"><p>list of objects of type <strong>rclpy.publisher.Publisher</strong> - publishers to the topics: <br />
/mapf_robot_action_"ID"</p>
</div>


                            </div>
                            <div id="Controller.publisher_instance" class="classattr">
                                <div class="attr variable">
            <span class="name">publisher_instance</span>

        
    </div>
    <a class="headerlink" href="#Controller.publisher_instance"></a>
    
            <div class="docstring"><p><strong>rclpy.publisher.Publisher</strong> - ros2 publisher to the topic <em>/mapf_instance_info</em></p>
</div>


                            </div>
                            <div id="Controller.subscriber_instance" class="classattr">
                                <div class="attr variable">
            <span class="name">subscriber_instance</span>

        
    </div>
    <a class="headerlink" href="#Controller.subscriber_instance"></a>
    
            <div class="docstring"><p><strong>rclpy.subscription.Subscription</strong> - ros2 subscriber to the topic <em>/mapf_instance_solution</em></p>
</div>


                            </div>
                            <div id="Controller.publisher_statistics" class="classattr">
                                <div class="attr variable">
            <span class="name">publisher_statistics</span>

        
    </div>
    <a class="headerlink" href="#Controller.publisher_statistics"></a>
    
            <div class="docstring"><p><strong>rclpy.publisher.Publisher</strong> - ros2 publisher to the topic <em>/mapf_statistics_info</em></p>
</div>


                            </div>
                            <div id="Controller.callback_mapinfo" class="classattr">
                                        <input id="Controller.callback_mapinfo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">callback_mapinfo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">msg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.callback_mapinfo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.callback_mapinfo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.callback_mapinfo-116"><a href="#Controller.callback_mapinfo-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">callback_mapinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="Controller.callback_mapinfo-117"><a href="#Controller.callback_mapinfo-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.callback_mapinfo-118"><a href="#Controller.callback_mapinfo-118"><span class="linenos">118</span></a><span class="sd">        This function will be called every time a message on the topic is received: */mapf_map_info*</span>
</span><span id="Controller.callback_mapinfo-119"><a href="#Controller.callback_mapinfo-119"><span class="linenos">119</span></a>
</span><span id="Controller.callback_mapinfo-120"><a href="#Controller.callback_mapinfo-120"><span class="linenos">120</span></a><span class="sd">        If the number of the robots has not changed since the last time this function has been called </span>
</span><span id="Controller.callback_mapinfo-121"><a href="#Controller.callback_mapinfo-121"><span class="linenos">121</span></a><span class="sd">        then:</span>
</span><span id="Controller.callback_mapinfo-122"><a href="#Controller.callback_mapinfo-122"><span class="linenos">122</span></a><span class="sd">        &gt;1) set the init flags for every robot to FALSE (meaning the robot is not ready yet)   </span>
</span><span id="Controller.callback_mapinfo-123"><a href="#Controller.callback_mapinfo-123"><span class="linenos">123</span></a><span class="sd">        &gt;2) delete all old messages received for the robots on the following topics: */mapf_robot_info_&quot;ID&quot;*</span>
</span><span id="Controller.callback_mapinfo-124"><a href="#Controller.callback_mapinfo-124"><span class="linenos">124</span></a><span class="sd">        </span>
</span><span id="Controller.callback_mapinfo-125"><a href="#Controller.callback_mapinfo-125"><span class="linenos">125</span></a><span class="sd">        If the number of the robots has changed since the last time this function has been called then:   </span>
</span><span id="Controller.callback_mapinfo-126"><a href="#Controller.callback_mapinfo-126"><span class="linenos">126</span></a><span class="sd">        (this is although TRUE if this function is beeing called for the first time)</span>
</span><span id="Controller.callback_mapinfo-127"><a href="#Controller.callback_mapinfo-127"><span class="linenos">127</span></a><span class="sd">        &gt;1) delete old Subscribers for the topics: */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="Controller.callback_mapinfo-128"><a href="#Controller.callback_mapinfo-128"><span class="linenos">128</span></a><span class="sd">            delete old Publishers for the topics: */mapf_robot_action_&quot;ID&quot;*  </span>
</span><span id="Controller.callback_mapinfo-129"><a href="#Controller.callback_mapinfo-129"><span class="linenos">129</span></a><span class="sd">            </span>
</span><span id="Controller.callback_mapinfo-130"><a href="#Controller.callback_mapinfo-130"><span class="linenos">130</span></a><span class="sd">        &gt;2) for every robot create a Publisher and Subscriber  </span>
</span><span id="Controller.callback_mapinfo-131"><a href="#Controller.callback_mapinfo-131"><span class="linenos">131</span></a><span class="sd">        (Publisher for */mapf_robot_info_&quot;ID&quot;* and Subscriber for */mapf_robot_action_&quot;ID&quot;*)</span>
</span><span id="Controller.callback_mapinfo-132"><a href="#Controller.callback_mapinfo-132"><span class="linenos">132</span></a><span class="sd">        </span>
</span><span id="Controller.callback_mapinfo-133"><a href="#Controller.callback_mapinfo-133"><span class="linenos">133</span></a><span class="sd">        &gt;3) set the init flags for every robot to FALSE (meaning the robot is not ready yet)   </span>
</span><span id="Controller.callback_mapinfo-134"><a href="#Controller.callback_mapinfo-134"><span class="linenos">134</span></a><span class="sd">        </span>
</span><span id="Controller.callback_mapinfo-135"><a href="#Controller.callback_mapinfo-135"><span class="linenos">135</span></a><span class="sd">        &gt;4) delete all old messages received for the robots on the following topics:   </span>
</span><span id="Controller.callback_mapinfo-136"><a href="#Controller.callback_mapinfo-136"><span class="linenos">136</span></a><span class="sd">           &gt;&gt; */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="Controller.callback_mapinfo-137"><a href="#Controller.callback_mapinfo-137"><span class="linenos">137</span></a><span class="sd">           &gt;&gt; */mapf_instance_info_&quot;ID&quot;*  </span>
</span><span id="Controller.callback_mapinfo-138"><a href="#Controller.callback_mapinfo-138"><span class="linenos">138</span></a><span class="sd">           &gt;&gt; */mapf_instance_solution_&quot;ID&quot;*  </span>
</span><span id="Controller.callback_mapinfo-139"><a href="#Controller.callback_mapinfo-139"><span class="linenos">139</span></a><span class="sd">        </span>
</span><span id="Controller.callback_mapinfo-140"><a href="#Controller.callback_mapinfo-140"><span class="linenos">140</span></a><span class="sd">        :param msg: mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</span>
</span><span id="Controller.callback_mapinfo-141"><a href="#Controller.callback_mapinfo-141"><span class="linenos">141</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.callback_mapinfo-142"><a href="#Controller.callback_mapinfo-142"><span class="linenos">142</span></a>
</span><span id="Controller.callback_mapinfo-143"><a href="#Controller.callback_mapinfo-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span><span id="Controller.callback_mapinfo-144"><a href="#Controller.callback_mapinfo-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span>
</span><span id="Controller.callback_mapinfo-145"><a href="#Controller.callback_mapinfo-145"><span class="linenos">145</span></a>        
</span><span id="Controller.callback_mapinfo-146"><a href="#Controller.callback_mapinfo-146"><span class="linenos">146</span></a>        <span class="c1">#save the received msg</span>
</span><span id="Controller.callback_mapinfo-147"><a href="#Controller.callback_mapinfo-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="Controller.callback_mapinfo-148"><a href="#Controller.callback_mapinfo-148"><span class="linenos">148</span></a>        <span class="c1">#mark that map message has already been received</span>
</span><span id="Controller.callback_mapinfo-149"><a href="#Controller.callback_mapinfo-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Controller.callback_mapinfo-150"><a href="#Controller.callback_mapinfo-150"><span class="linenos">150</span></a>        
</span><span id="Controller.callback_mapinfo-151"><a href="#Controller.callback_mapinfo-151"><span class="linenos">151</span></a>        <span class="c1">#if the number of robots from last time hasn&#39;t changed then</span>
</span><span id="Controller.callback_mapinfo-152"><a href="#Controller.callback_mapinfo-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_robots_changed</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
</span><span id="Controller.callback_mapinfo-153"><a href="#Controller.callback_mapinfo-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="Controller.callback_mapinfo-154"><a href="#Controller.callback_mapinfo-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="Controller.callback_mapinfo-155"><a href="#Controller.callback_mapinfo-155"><span class="linenos">155</span></a>            <span class="k">return</span>
</span><span id="Controller.callback_mapinfo-156"><a href="#Controller.callback_mapinfo-156"><span class="linenos">156</span></a>        
</span><span id="Controller.callback_mapinfo-157"><a href="#Controller.callback_mapinfo-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clear_robots</span><span class="p">()</span>
</span><span id="Controller.callback_mapinfo-158"><a href="#Controller.callback_mapinfo-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span>
</span><span id="Controller.callback_mapinfo-159"><a href="#Controller.callback_mapinfo-159"><span class="linenos">159</span></a>        
</span><span id="Controller.callback_mapinfo-160"><a href="#Controller.callback_mapinfo-160"><span class="linenos">160</span></a>        <span class="c1">#create publisher[RobotAction.msg] and subscriber[RobotInfo.msg] for every robot</span>
</span><span id="Controller.callback_mapinfo-161"><a href="#Controller.callback_mapinfo-161"><span class="linenos">161</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span><span class="p">):</span>
</span><span id="Controller.callback_mapinfo-162"><a href="#Controller.callback_mapinfo-162"><span class="linenos">162</span></a>            <span class="c1">#create subscriber</span>
</span><span id="Controller.callback_mapinfo-163"><a href="#Controller.callback_mapinfo-163"><span class="linenos">163</span></a>            <span class="n">subscriber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">RobotInfo</span><span class="p">,</span> <span class="s1">&#39;mapf_robot_info_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
</span><span id="Controller.callback_mapinfo-164"><a href="#Controller.callback_mapinfo-164"><span class="linenos">164</span></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">callback_robotinfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller.callback_mapinfo-165"><a href="#Controller.callback_mapinfo-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
</span><span id="Controller.callback_mapinfo-166"><a href="#Controller.callback_mapinfo-166"><span class="linenos">166</span></a>            <span class="c1">#create publisher</span>
</span><span id="Controller.callback_mapinfo-167"><a href="#Controller.callback_mapinfo-167"><span class="linenos">167</span></a>            <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">RobotAction</span><span class="p">,</span> <span class="s1">&#39;mapf_robot_action_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Controller.callback_mapinfo-168"><a href="#Controller.callback_mapinfo-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">publisher</span><span class="p">)</span>
</span><span id="Controller.callback_mapinfo-169"><a href="#Controller.callback_mapinfo-169"><span class="linenos">169</span></a>
</span><span id="Controller.callback_mapinfo-170"><a href="#Controller.callback_mapinfo-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span><span id="Controller.callback_mapinfo-171"><a href="#Controller.callback_mapinfo-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function will be called every time a message on the topic is received: <em>/mapf_map_info</em></p>

<p>If the number of the robots has not changed since the last time this function has been called 
then:</p>

<blockquote>
  <p>1) set the init flags for every robot to FALSE (meaning the robot is not ready yet) <br />
  2) delete all old messages received for the robots on the following topics: <em>/mapf_robot_info_"ID"</em></p>
</blockquote>

<p>If the number of the robots has changed since the last time this function has been called then: <br />
(this is although TRUE if this function is beeing called for the first time)</p>

<blockquote>
  <p>1) delete old Subscribers for the topics: <em>/mapf_robot_info_"ID"</em> <br />
      delete old Publishers for the topics: <em>/mapf_robot_action_"ID"</em>  </p>
</blockquote>

<blockquote>
  <p>2) for every robot create a Publisher and Subscriber <br />
  (Publisher for <em>/mapf_robot_info_"ID"</em> and Subscriber for <em>/mapf_robot_action_"ID"</em>)</p>
</blockquote>

<blockquote>
  <p>3) set the init flags for every robot to FALSE (meaning the robot is not ready yet)   </p>
</blockquote>

<blockquote>
  <p>4) delete all old messages received for the robots on the following topics:   </p>
  
  <blockquote>
    <p><em>/mapf_robot_info_"ID"</em> <br />
    <em>/mapf_instance_info_"ID"</em> <br />
    <em>/mapf_instance_solution_"ID"</em>  </p>
  </blockquote>
</blockquote>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>msg</strong>:  mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</li>
</ul>
</div>


                            </div>
                            <div id="Controller.callback_robotinfo" class="classattr">
                                        <input id="Controller.callback_robotinfo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">callback_robotinfo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">msg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.callback_robotinfo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.callback_robotinfo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.callback_robotinfo-173"><a href="#Controller.callback_robotinfo-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">callback_robotinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>    
</span><span id="Controller.callback_robotinfo-174"><a href="#Controller.callback_robotinfo-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.callback_robotinfo-175"><a href="#Controller.callback_robotinfo-175"><span class="linenos">175</span></a><span class="sd">        This function will be called every time a message on the following topics is received: */mapf_robot_info_&quot;ID&quot;*  </span>
</span><span id="Controller.callback_robotinfo-176"><a href="#Controller.callback_robotinfo-176"><span class="linenos">176</span></a>
</span><span id="Controller.callback_robotinfo-177"><a href="#Controller.callback_robotinfo-177"><span class="linenos">177</span></a><span class="sd">        CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle.   </span>
</span><span id="Controller.callback_robotinfo-178"><a href="#Controller.callback_robotinfo-178"><span class="linenos">178</span></a><span class="sd">        If the numbers are not equal, then the information in the message is old and will be ignored.  </span>
</span><span id="Controller.callback_robotinfo-179"><a href="#Controller.callback_robotinfo-179"><span class="linenos">179</span></a><span class="sd">        If the numbers are equal then, the CONTROLLER saves the message and sets the INIT-flag for the corresponding robot to TRUE!  </span>
</span><span id="Controller.callback_robotinfo-180"><a href="#Controller.callback_robotinfo-180"><span class="linenos">180</span></a>
</span><span id="Controller.callback_robotinfo-181"><a href="#Controller.callback_robotinfo-181"><span class="linenos">181</span></a><span class="sd">        :param msg: mapf_interfaces/RobotInfo.msg - message from the topic /mapf_robot_info_ID</span>
</span><span id="Controller.callback_robotinfo-182"><a href="#Controller.callback_robotinfo-182"><span class="linenos">182</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.callback_robotinfo-183"><a href="#Controller.callback_robotinfo-183"><span class="linenos">183</span></a>
</span><span id="Controller.callback_robotinfo-184"><a href="#Controller.callback_robotinfo-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">:</span>
</span><span id="Controller.callback_robotinfo-185"><a href="#Controller.callback_robotinfo-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RobotInfo.msg received, but with an old ID = </span><span class="si">%d</span><span class="s2">. Skip the message&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller.callback_robotinfo-186"><a href="#Controller.callback_robotinfo-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;msg.id = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller.callback_robotinfo-187"><a href="#Controller.callback_robotinfo-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;self.current_id_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">)</span>
</span><span id="Controller.callback_robotinfo-188"><a href="#Controller.callback_robotinfo-188"><span class="linenos">188</span></a>            <span class="k">return</span>    
</span><span id="Controller.callback_robotinfo-189"><a href="#Controller.callback_robotinfo-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Controller.callback_robotinfo-190"><a href="#Controller.callback_robotinfo-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="Controller.callback_robotinfo-191"><a href="#Controller.callback_robotinfo-191"><span class="linenos">191</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialising ROBOT with ID: &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="p">)</span>    
</span></pre></div>


            <div class="docstring"><p>This function will be called every time a message on the following topics is received: <em>/mapf_robot_info_"ID"</em>  </p>

<p>CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle. <br />
If the numbers are not equal, then the information in the message is old and will be ignored. <br />
If the numbers are equal then, the CONTROLLER saves the message and sets the INIT-flag for the corresponding robot to TRUE!  </p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>msg</strong>:  mapf_interfaces/RobotInfo.msg - message from the topic /mapf_robot_info_ID</li>
</ul>
</div>


                            </div>
                            <div id="Controller.callback_solution" class="classattr">
                                        <input id="Controller.callback_solution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">callback_solution</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">msg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.callback_solution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.callback_solution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.callback_solution-193"><a href="#Controller.callback_solution-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">callback_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="Controller.callback_solution-194"><a href="#Controller.callback_solution-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.callback_solution-195"><a href="#Controller.callback_solution-195"><span class="linenos">195</span></a><span class="sd">        This function will be called every time a message on the following topics is received: */mapf_instance_solution*  </span>
</span><span id="Controller.callback_solution-196"><a href="#Controller.callback_solution-196"><span class="linenos">196</span></a>
</span><span id="Controller.callback_solution-197"><a href="#Controller.callback_solution-197"><span class="linenos">197</span></a><span class="sd">        CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle.   </span>
</span><span id="Controller.callback_solution-198"><a href="#Controller.callback_solution-198"><span class="linenos">198</span></a><span class="sd">        If the numbers are not equal, then the information in the message is old and will be ignored.  </span>
</span><span id="Controller.callback_solution-199"><a href="#Controller.callback_solution-199"><span class="linenos">199</span></a><span class="sd">        If the numbers are equal, then the CONTROLLER saves the message/solution.</span>
</span><span id="Controller.callback_solution-200"><a href="#Controller.callback_solution-200"><span class="linenos">200</span></a>
</span><span id="Controller.callback_solution-201"><a href="#Controller.callback_solution-201"><span class="linenos">201</span></a><span class="sd">        :param msg: mapf_interfaces/MAPFSolution.msg - message from the topic /mapf_instance_solution</span>
</span><span id="Controller.callback_solution-202"><a href="#Controller.callback_solution-202"><span class="linenos">202</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.callback_solution-203"><a href="#Controller.callback_solution-203"><span class="linenos">203</span></a>        
</span><span id="Controller.callback_solution-204"><a href="#Controller.callback_solution-204"><span class="linenos">204</span></a>        <span class="c1">#skip solutions for old instances </span>
</span><span id="Controller.callback_solution-205"><a href="#Controller.callback_solution-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">:</span>
</span><span id="Controller.callback_solution-206"><a href="#Controller.callback_solution-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAPFSolution.msg received, but with an old ID = </span><span class="si">%d</span><span class="s2">. Skip the message&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller.callback_solution-207"><a href="#Controller.callback_solution-207"><span class="linenos">207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;msg.id = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="Controller.callback_solution-208"><a href="#Controller.callback_solution-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;self.current_id_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span><span class="p">)</span>
</span><span id="Controller.callback_solution-209"><a href="#Controller.callback_solution-209"><span class="linenos">209</span></a>            <span class="k">return</span>
</span><span id="Controller.callback_solution-210"><a href="#Controller.callback_solution-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MAPFSolution.msg received, ID = </span><span class="si">%d</span><span class="s2">, STEP: </span><span class="si">%d</span><span class="s2">, algorithm: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">name_algorithm</span><span class="p">))</span>                              
</span><span id="Controller.callback_solution-211"><a href="#Controller.callback_solution-211"><span class="linenos">211</span></a>        <span class="c1">#self._solution_msgs.append(msg)</span>
</span><span id="Controller.callback_solution-212"><a href="#Controller.callback_solution-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function will be called every time a message on the following topics is received: <em>/mapf_instance_solution</em>  </p>

<p>CONTROLLER checks whether the ID in the message is equal to the ID of the current cycle. <br />
If the numbers are not equal, then the information in the message is old and will be ignored. <br />
If the numbers are equal, then the CONTROLLER saves the message/solution.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>msg</strong>:  mapf_interfaces/MAPFSolution.msg - message from the topic /mapf_instance_solution</li>
</ul>
</div>


                            </div>
                            <div id="Controller.publish_instance_msg" class="classattr">
                                        <input id="Controller.publish_instance_msg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">publish_instance_msg</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.publish_instance_msg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.publish_instance_msg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.publish_instance_msg-214"><a href="#Controller.publish_instance_msg-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">publish_instance_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller.publish_instance_msg-215"><a href="#Controller.publish_instance_msg-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.publish_instance_msg-216"><a href="#Controller.publish_instance_msg-216"><span class="linenos">216</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/MAPFInstance.msg] and publishes it to the following topic: */mapf_instance_info*  </span>
</span><span id="Controller.publish_instance_msg-217"><a href="#Controller.publish_instance_msg-217"><span class="linenos">217</span></a>
</span><span id="Controller.publish_instance_msg-218"><a href="#Controller.publish_instance_msg-218"><span class="linenos">218</span></a><span class="sd">        The message will be generated by fusing the information from the arrived messages on the following topics:  </span>
</span><span id="Controller.publish_instance_msg-219"><a href="#Controller.publish_instance_msg-219"><span class="linenos">219</span></a><span class="sd">        */mapf_map_info* [mapf_interfaces/MapInfo.msg] and   </span>
</span><span id="Controller.publish_instance_msg-220"><a href="#Controller.publish_instance_msg-220"><span class="linenos">220</span></a><span class="sd">        */mapf_robot_info_ID* [mapf_interfaces/RobotInfo.msg] for every robot </span>
</span><span id="Controller.publish_instance_msg-221"><a href="#Controller.publish_instance_msg-221"><span class="linenos">221</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.publish_instance_msg-222"><a href="#Controller.publish_instance_msg-222"><span class="linenos">222</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">MAPFInstance</span><span class="p">()</span>
</span><span id="Controller.publish_instance_msg-223"><a href="#Controller.publish_instance_msg-223"><span class="linenos">223</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span>
</span><span id="Controller.publish_instance_msg-224"><a href="#Controller.publish_instance_msg-224"><span class="linenos">224</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span><span class="o">.</span><span class="n">step</span>
</span><span id="Controller.publish_instance_msg-225"><a href="#Controller.publish_instance_msg-225"><span class="linenos">225</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_msg</span>
</span><span id="Controller.publish_instance_msg-226"><a href="#Controller.publish_instance_msg-226"><span class="linenos">226</span></a>        <span class="k">for</span> <span class="n">robot_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">:</span>
</span><span id="Controller.publish_instance_msg-227"><a href="#Controller.publish_instance_msg-227"><span class="linenos">227</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_msg</span><span class="p">)</span>
</span><span id="Controller.publish_instance_msg-228"><a href="#Controller.publish_instance_msg-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_instance</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Controller.publish_instance_msg-229"><a href="#Controller.publish_instance_msg-229"><span class="linenos">229</span></a>        <span class="c1">#save the published message for later to check with corresponding answer</span>
</span><span id="Controller.publish_instance_msg-230"><a href="#Controller.publish_instance_msg-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="Controller.publish_instance_msg-231"><a href="#Controller.publish_instance_msg-231"><span class="linenos">231</span></a>        <span class="c1">#delete all solutions for an older instance!!!!</span>
</span><span id="Controller.publish_instance_msg-232"><a href="#Controller.publish_instance_msg-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>This function generates a ros2 message of type [mapf_interfaces/MAPFInstance.msg] and publishes it to the following topic: <em>/mapf_instance_info</em>  </p>

<p>The message will be generated by fusing the information from the arrived messages on the following topics: <br />
<em>/mapf_map_info</em> [mapf_interfaces/MapInfo.msg] and <br />
<em>/mapf_robot_info_ID</em> [mapf_interfaces/RobotInfo.msg] for every robot</p>
</div>


                            </div>
                            <div id="Controller.publish_action_msg" class="classattr">
                                        <input id="Controller.publish_action_msg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">publish_action_msg</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.publish_action_msg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.publish_action_msg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.publish_action_msg-234"><a href="#Controller.publish_action_msg-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">publish_action_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>         
</span><span id="Controller.publish_action_msg-235"><a href="#Controller.publish_action_msg-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.publish_action_msg-236"><a href="#Controller.publish_action_msg-236"><span class="linenos">236</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/RobotAction.msg] and publishes it to the following topic: */mapf_robot_action_ID*  </span>
</span><span id="Controller.publish_action_msg-237"><a href="#Controller.publish_action_msg-237"><span class="linenos">237</span></a><span class="sd">        </span>
</span><span id="Controller.publish_action_msg-238"><a href="#Controller.publish_action_msg-238"><span class="linenos">238</span></a><span class="sd">        The message will be generated from the received solution by the pathplanner: */mapf_solution_info* [mapf_interfaces/MAPFSolution.msg].  </span>
</span><span id="Controller.publish_action_msg-239"><a href="#Controller.publish_action_msg-239"><span class="linenos">239</span></a><span class="sd">        The solution defines the paths for every robot. Every path is defined by a set of points. The action for every robot will be defined by the difference </span>
</span><span id="Controller.publish_action_msg-240"><a href="#Controller.publish_action_msg-240"><span class="linenos">240</span></a><span class="sd">        between the first two points from their path.</span>
</span><span id="Controller.publish_action_msg-241"><a href="#Controller.publish_action_msg-241"><span class="linenos">241</span></a><span class="sd">        The first point in the path describes the actual position of the robot, the second point the next target point from the path.</span>
</span><span id="Controller.publish_action_msg-242"><a href="#Controller.publish_action_msg-242"><span class="linenos">242</span></a><span class="sd">        </span>
</span><span id="Controller.publish_action_msg-243"><a href="#Controller.publish_action_msg-243"><span class="linenos">243</span></a><span class="sd">        :param int: solution_number - defines which solution should be used for generating the actions for the robot  </span>
</span><span id="Controller.publish_action_msg-244"><a href="#Controller.publish_action_msg-244"><span class="linenos">244</span></a><span class="sd">        (at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one </span>
</span><span id="Controller.publish_action_msg-245"><a href="#Controller.publish_action_msg-245"><span class="linenos">245</span></a><span class="sd">        solution and choose the best one of those. For that matter it should be possible to define which solution should be used here)</span>
</span><span id="Controller.publish_action_msg-246"><a href="#Controller.publish_action_msg-246"><span class="linenos">246</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.publish_action_msg-247"><a href="#Controller.publish_action_msg-247"><span class="linenos">247</span></a>        <span class="k">for</span> <span class="n">pathInfoMsg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">[</span><span class="n">solution_number</span><span class="p">]</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
</span><span id="Controller.publish_action_msg-248"><a href="#Controller.publish_action_msg-248"><span class="linenos">248</span></a>        <span class="c1">#for pathInfoMsg in self.solution_msg.paths:</span>
</span><span id="Controller.publish_action_msg-249"><a href="#Controller.publish_action_msg-249"><span class="linenos">249</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">RobotAction</span><span class="p">()</span>
</span><span id="Controller.publish_action_msg-250"><a href="#Controller.publish_action_msg-250"><span class="linenos">250</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_id_cycle</span>
</span><span id="Controller.publish_action_msg-251"><a href="#Controller.publish_action_msg-251"><span class="linenos">251</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">step</span>
</span><span id="Controller.publish_action_msg-252"><a href="#Controller.publish_action_msg-252"><span class="linenos">252</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">robot_id</span>
</span><span id="Controller.publish_action_msg-253"><a href="#Controller.publish_action_msg-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Controller.publish_action_msg-254"><a href="#Controller.publish_action_msg-254"><span class="linenos">254</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Controller.publish_action_msg-255"><a href="#Controller.publish_action_msg-255"><span class="linenos">255</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Controller.publish_action_msg-256"><a href="#Controller.publish_action_msg-256"><span class="linenos">256</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Controller.publish_action_msg-257"><a href="#Controller.publish_action_msg-257"><span class="linenos">257</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Controller.publish_action_msg-258"><a href="#Controller.publish_action_msg-258"><span class="linenos">258</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_x</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_x</span>
</span><span id="Controller.publish_action_msg-259"><a href="#Controller.publish_action_msg-259"><span class="linenos">259</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">move_y</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_y</span>
</span><span id="Controller.publish_action_msg-260"><a href="#Controller.publish_action_msg-260"><span class="linenos">260</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span> <span class="o">-</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span>
</span><span id="Controller.publish_action_msg-261"><a href="#Controller.publish_action_msg-261"><span class="linenos">261</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">pathInfoMsg</span><span class="o">.</span><span class="n">path</span>
</span><span id="Controller.publish_action_msg-262"><a href="#Controller.publish_action_msg-262"><span class="linenos">262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">robot_id</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Controller.publish_action_msg-263"><a href="#Controller.publish_action_msg-263"><span class="linenos">263</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function generates a ros2 message of type [mapf_interfaces/RobotAction.msg] and publishes it to the following topic: <em>/mapf_robot_action_ID</em>  </p>

<p>The message will be generated from the received solution by the pathplanner: <em>/mapf_solution_info</em> [mapf_interfaces/MAPFSolution.msg]. <br />
The solution defines the paths for every robot. Every path is defined by a set of points. The action for every robot will be defined by the difference 
between the first two points from their path.
The first point in the path describes the actual position of the robot, the second point the next target point from the path.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>int</strong>:  solution_number - defines which solution should be used for generating the actions for the robot <br />
(at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one 
solution and choose the best one of those. For that matter it should be possible to define which solution should be used here)</li>
</ul>
</div>


                            </div>
                            <div id="Controller.publish_statistics_msg" class="classattr">
                                        <input id="Controller.publish_statistics_msg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">publish_statistics_msg</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.publish_statistics_msg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.publish_statistics_msg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.publish_statistics_msg-265"><a href="#Controller.publish_statistics_msg-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">publish_statistics_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Controller.publish_statistics_msg-266"><a href="#Controller.publish_statistics_msg-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.publish_statistics_msg-267"><a href="#Controller.publish_statistics_msg-267"><span class="linenos">267</span></a><span class="sd">        This function generates a ros2 message of type [mapf_interfaces/StatisticInfo.msg]</span>
</span><span id="Controller.publish_statistics_msg-268"><a href="#Controller.publish_statistics_msg-268"><span class="linenos">268</span></a><span class="sd">        and publishes it to the following topic: */mapf_statistics_info*  </span>
</span><span id="Controller.publish_statistics_msg-269"><a href="#Controller.publish_statistics_msg-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="Controller.publish_statistics_msg-270"><a href="#Controller.publish_statistics_msg-270"><span class="linenos">270</span></a><span class="sd">        The content for the message can be extracted directly from the saved solution (MAPFSolution.msg).</span>
</span><span id="Controller.publish_statistics_msg-271"><a href="#Controller.publish_statistics_msg-271"><span class="linenos">271</span></a>
</span><span id="Controller.publish_statistics_msg-272"><a href="#Controller.publish_statistics_msg-272"><span class="linenos">272</span></a><span class="sd">        :param int: solution_number - defines which solution should be used for generating the message  </span>
</span><span id="Controller.publish_statistics_msg-273"><a href="#Controller.publish_statistics_msg-273"><span class="linenos">273</span></a><span class="sd">        (at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one </span>
</span><span id="Controller.publish_statistics_msg-274"><a href="#Controller.publish_statistics_msg-274"><span class="linenos">274</span></a><span class="sd">        solution and choose the best one of those. For that matter it should be possible to define here which solution should be used)</span>
</span><span id="Controller.publish_statistics_msg-275"><a href="#Controller.publish_statistics_msg-275"><span class="linenos">275</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.publish_statistics_msg-276"><a href="#Controller.publish_statistics_msg-276"><span class="linenos">276</span></a>        <span class="c1">#msg = self._solution_msgs[solution_number].statistics</span>
</span><span id="Controller.publish_statistics_msg-277"><a href="#Controller.publish_statistics_msg-277"><span class="linenos">277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher_statistics</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">[</span><span class="n">solution_number</span><span class="p">]</span><span class="o">.</span><span class="n">statistics</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function generates a ros2 message of type [mapf_interfaces/StatisticInfo.msg]
and publishes it to the following topic: <em>/mapf_statistics_info</em>  </p>

<p>The content for the message can be extracted directly from the saved solution (MAPFSolution.msg).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>int</strong>:  solution_number - defines which solution should be used for generating the message <br />
(at the moment the CONTROLLER can save only one solution at the same time, but in future it should be possible to save more than one 
solution and choose the best one of those. For that matter it should be possible to define here which solution should be used)</li>
</ul>
</div>


                            </div>
                            <div id="Controller.check_init_robots" class="classattr">
                                        <input id="Controller.check_init_robots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_init_robots</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.check_init_robots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.check_init_robots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.check_init_robots-279"><a href="#Controller.check_init_robots-279"><span class="linenos">279</span></a>    <span class="k">def</span> <span class="nf">check_init_robots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   
</span><span id="Controller.check_init_robots-280"><a href="#Controller.check_init_robots-280"><span class="linenos">280</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.check_init_robots-281"><a href="#Controller.check_init_robots-281"><span class="linenos">281</span></a><span class="sd">        This function checks whether the flag for every robot is set to TRUE. </span>
</span><span id="Controller.check_init_robots-282"><a href="#Controller.check_init_robots-282"><span class="linenos">282</span></a><span class="sd">        </span>
</span><span id="Controller.check_init_robots-283"><a href="#Controller.check_init_robots-283"><span class="linenos">283</span></a><span class="sd">        This function is used to check whether the information about all the robots</span>
</span><span id="Controller.check_init_robots-284"><a href="#Controller.check_init_robots-284"><span class="linenos">284</span></a><span class="sd">        has been received by the CONTROLLER from the SIMULATION.</span>
</span><span id="Controller.check_init_robots-285"><a href="#Controller.check_init_robots-285"><span class="linenos">285</span></a>
</span><span id="Controller.check_init_robots-286"><a href="#Controller.check_init_robots-286"><span class="linenos">286</span></a><span class="sd">        :return: **True**, if the flag for every robot is set to TRUE in the CONTROLLER  </span>
</span><span id="Controller.check_init_robots-287"><a href="#Controller.check_init_robots-287"><span class="linenos">287</span></a><span class="sd">        **False**, otherwise</span>
</span><span id="Controller.check_init_robots-288"><a href="#Controller.check_init_robots-288"><span class="linenos">288</span></a>
</span><span id="Controller.check_init_robots-289"><a href="#Controller.check_init_robots-289"><span class="linenos">289</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.check_init_robots-290"><a href="#Controller.check_init_robots-290"><span class="linenos">290</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Controller.check_init_robots-291"><a href="#Controller.check_init_robots-291"><span class="linenos">291</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Controller.check_init_robots-292"><a href="#Controller.check_init_robots-292"><span class="linenos">292</span></a>        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">:</span>
</span><span id="Controller.check_init_robots-293"><a href="#Controller.check_init_robots-293"><span class="linenos">293</span></a>            <span class="k">if</span> <span class="n">robot</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Controller.check_init_robots-294"><a href="#Controller.check_init_robots-294"><span class="linenos">294</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Controller.check_init_robots-295"><a href="#Controller.check_init_robots-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>This function checks whether the flag for every robot is set to TRUE. </p>

<p>This function is used to check whether the information about all the robots
has been received by the CONTROLLER from the SIMULATION.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p><strong>True</strong>, if the flag for every robot is set to TRUE in the CONTROLLER <br />
  <strong>False</strong>, otherwise</p>
</blockquote>
</div>


                            </div>
                            <div id="Controller.all_agents_at_target" class="classattr">
                                        <input id="Controller.all_agents_at_target-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">all_agents_at_target</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.all_agents_at_target-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.all_agents_at_target"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.all_agents_at_target-297"><a href="#Controller.all_agents_at_target-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">all_agents_at_target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller.all_agents_at_target-298"><a href="#Controller.all_agents_at_target-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.all_agents_at_target-299"><a href="#Controller.all_agents_at_target-299"><span class="linenos">299</span></a><span class="sd">        This function checks if all robots have visited all their checkpoints. If it is the case then all robots have reached their targets!</span>
</span><span id="Controller.all_agents_at_target-300"><a href="#Controller.all_agents_at_target-300"><span class="linenos">300</span></a><span class="sd">        :return: **True**, if all robots have visited all their checkpoints  </span>
</span><span id="Controller.all_agents_at_target-301"><a href="#Controller.all_agents_at_target-301"><span class="linenos">301</span></a><span class="sd">        **False**, otherwise</span>
</span><span id="Controller.all_agents_at_target-302"><a href="#Controller.all_agents_at_target-302"><span class="linenos">302</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.all_agents_at_target-303"><a href="#Controller.all_agents_at_target-303"><span class="linenos">303</span></a>        <span class="k">for</span> <span class="n">robot_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span><span class="p">:</span>
</span><span id="Controller.all_agents_at_target-304"><a href="#Controller.all_agents_at_target-304"><span class="linenos">304</span></a>           <span class="k">for</span> <span class="n">checkpoint_msg</span> <span class="ow">in</span> <span class="n">robot_msg</span><span class="o">.</span><span class="n">checkpoints</span><span class="p">:</span>
</span><span id="Controller.all_agents_at_target-305"><a href="#Controller.all_agents_at_target-305"><span class="linenos">305</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpoint_msg</span><span class="o">.</span><span class="n">visited</span><span class="p">:</span>
</span><span id="Controller.all_agents_at_target-306"><a href="#Controller.all_agents_at_target-306"><span class="linenos">306</span></a>                   <span class="c1">#print(&quot;CHECKPOINT NOT VISITED&quot;)</span>
</span><span id="Controller.all_agents_at_target-307"><a href="#Controller.all_agents_at_target-307"><span class="linenos">307</span></a>                   <span class="c1">#print(checkpoint_msg.position.pos_x)</span>
</span><span id="Controller.all_agents_at_target-308"><a href="#Controller.all_agents_at_target-308"><span class="linenos">308</span></a>                   <span class="c1">#print(checkpoint_msg.position.pos_y)</span>
</span><span id="Controller.all_agents_at_target-309"><a href="#Controller.all_agents_at_target-309"><span class="linenos">309</span></a>                   <span class="k">return</span> <span class="kc">False</span>
</span><span id="Controller.all_agents_at_target-310"><a href="#Controller.all_agents_at_target-310"><span class="linenos">310</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>This function checks if all robots have visited all their checkpoints. If it is the case then all robots have reached their targets!</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p><strong>True</strong>, if all robots have visited all their checkpoints <br />
  <strong>False</strong>, otherwise</p>
</blockquote>
</div>


                            </div>
                            <div id="Controller.number_robots_changed" class="classattr">
                                        <input id="Controller.number_robots_changed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">number_robots_changed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">msg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.number_robots_changed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.number_robots_changed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.number_robots_changed-312"><a href="#Controller.number_robots_changed-312"><span class="linenos">312</span></a>    <span class="k">def</span> <span class="nf">number_robots_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span><span id="Controller.number_robots_changed-313"><a href="#Controller.number_robots_changed-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.number_robots_changed-314"><a href="#Controller.number_robots_changed-314"><span class="linenos">314</span></a><span class="sd">        This function checks whether the number of the robots has changed from the last time (last time CONTROLLER received the MapInfo.msg). </span>
</span><span id="Controller.number_robots_changed-315"><a href="#Controller.number_robots_changed-315"><span class="linenos">315</span></a><span class="sd">        </span>
</span><span id="Controller.number_robots_changed-316"><a href="#Controller.number_robots_changed-316"><span class="linenos">316</span></a><span class="sd">        :param msg: mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</span>
</span><span id="Controller.number_robots_changed-317"><a href="#Controller.number_robots_changed-317"><span class="linenos">317</span></a>
</span><span id="Controller.number_robots_changed-318"><a href="#Controller.number_robots_changed-318"><span class="linenos">318</span></a><span class="sd">        :return: **True**, if the number of the robots has changed or if the CONTROLLER has not received any MapInfo.msg so far  </span>
</span><span id="Controller.number_robots_changed-319"><a href="#Controller.number_robots_changed-319"><span class="linenos">319</span></a><span class="sd">        **False**, if the number of the robots has not changed</span>
</span><span id="Controller.number_robots_changed-320"><a href="#Controller.number_robots_changed-320"><span class="linenos">320</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.number_robots_changed-321"><a href="#Controller.number_robots_changed-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_received</span><span class="p">:</span>
</span><span id="Controller.number_robots_changed-322"><a href="#Controller.number_robots_changed-322"><span class="linenos">322</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Controller.number_robots_changed-323"><a href="#Controller.number_robots_changed-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_robots</span> <span class="o">!=</span> <span class="n">msg</span><span class="o">.</span><span class="n">number_robots</span><span class="p">:</span>
</span><span id="Controller.number_robots_changed-324"><a href="#Controller.number_robots_changed-324"><span class="linenos">324</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Controller.number_robots_changed-325"><a href="#Controller.number_robots_changed-325"><span class="linenos">325</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>This function checks whether the number of the robots has changed from the last time (last time CONTROLLER received the MapInfo.msg). </p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>msg</strong>:  mapf_interfaces/MapInfo.msg - message from the topic /mapf_map_info</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p><strong>True</strong>, if the number of the robots has changed or if the CONTROLLER has not received any MapInfo.msg so far <br />
  <strong>False</strong>, if the number of the robots has not changed</p>
</blockquote>
</div>


                            </div>
                            <div id="Controller.clear_robots" class="classattr">
                                        <input id="Controller.clear_robots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear_robots</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.clear_robots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.clear_robots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.clear_robots-327"><a href="#Controller.clear_robots-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">clear_robots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller.clear_robots-328"><a href="#Controller.clear_robots-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.clear_robots-329"><a href="#Controller.clear_robots-329"><span class="linenos">329</span></a><span class="sd">        This function is executing the following procedures:</span>
</span><span id="Controller.clear_robots-330"><a href="#Controller.clear_robots-330"><span class="linenos">330</span></a><span class="sd">        &gt;   1) deleting all Subscribers to and received messages on the following topics: /mapf_robot_info_&quot;ID&quot;  </span>
</span><span id="Controller.clear_robots-331"><a href="#Controller.clear_robots-331"><span class="linenos">331</span></a><span class="sd">            2) deleting all Publishers to the following topics: /mapf_robot_action_&quot;ID&quot;  </span>
</span><span id="Controller.clear_robots-332"><a href="#Controller.clear_robots-332"><span class="linenos">332</span></a><span class="sd">            3) deleting all created Instances for the pathplanners and all received solutions from the pathplanners  </span>
</span><span id="Controller.clear_robots-333"><a href="#Controller.clear_robots-333"><span class="linenos">333</span></a><span class="sd">            4) at the end resets the STATE of the CONTROLLER to MODE_INIT </span>
</span><span id="Controller.clear_robots-334"><a href="#Controller.clear_robots-334"><span class="linenos">334</span></a>
</span><span id="Controller.clear_robots-335"><a href="#Controller.clear_robots-335"><span class="linenos">335</span></a><span class="sd">        This function is called when the number of the robots has changed. In that case the old data will be deleted </span>
</span><span id="Controller.clear_robots-336"><a href="#Controller.clear_robots-336"><span class="linenos">336</span></a><span class="sd">        and a new initialisation of the CONTROLLER with the new number of robots will be carried out.</span>
</span><span id="Controller.clear_robots-337"><a href="#Controller.clear_robots-337"><span class="linenos">337</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.clear_robots-338"><a href="#Controller.clear_robots-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publishers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller.clear_robots-339"><a href="#Controller.clear_robots-339"><span class="linenos">339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribers_robot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Controller.clear_robots-340"><a href="#Controller.clear_robots-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_msgs</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#list of RobotInfo.msg</span>
</span><span id="Controller.clear_robots-341"><a href="#Controller.clear_robots-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_msg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Controller.clear_robots-342"><a href="#Controller.clear_robots-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#list of MAPFSolution.msg</span>
</span><span id="Controller.clear_robots-343"><a href="#Controller.clear_robots-343"><span class="linenos">343</span></a>        
</span><span id="Controller.clear_robots-344"><a href="#Controller.clear_robots-344"><span class="linenos">344</span></a>        <span class="c1">#list of flags for every robot</span>
</span><span id="Controller.clear_robots-345"><a href="#Controller.clear_robots-345"><span class="linenos">345</span></a>        <span class="c1">#if RobotInfo message received for the robot with ID, then list[ID-1]=True</span>
</span><span id="Controller.clear_robots-346"><a href="#Controller.clear_robots-346"><span class="linenos">346</span></a>        <span class="c1">#self._robots_received = [] #Notice: ID starts with 1 while list with 0!        </span>
</span><span id="Controller.clear_robots-347"><a href="#Controller.clear_robots-347"><span class="linenos">347</span></a>        <span class="c1">#self._solutions_received = []</span>
</span><span id="Controller.clear_robots-348"><a href="#Controller.clear_robots-348"><span class="linenos">348</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span></pre></div>


            <div class="docstring"><p>This function is executing the following procedures:</p>

<blockquote>
  <p>1) deleting all Subscribers to and received messages on the following topics: /mapf_robot_info_"ID" <br />
      2) deleting all Publishers to the following topics: /mapf_robot_action_"ID" <br />
      3) deleting all created Instances for the pathplanners and all received solutions from the pathplanners <br />
      4) at the end resets the STATE of the CONTROLLER to MODE_INIT </p>
</blockquote>

<p>This function is called when the number of the robots has changed. In that case the old data will be deleted 
and a new initialisation of the CONTROLLER with the new number of robots will be carried out.</p>
</div>


                            </div>
                            <div id="Controller.print_missing_robot_info" class="classattr">
                                        <input id="Controller.print_missing_robot_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_missing_robot_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Controller.print_missing_robot_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Controller.print_missing_robot_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Controller.print_missing_robot_info-350"><a href="#Controller.print_missing_robot_info-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">print_missing_robot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Controller.print_missing_robot_info-351"><a href="#Controller.print_missing_robot_info-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Controller.print_missing_robot_info-352"><a href="#Controller.print_missing_robot_info-352"><span class="linenos">352</span></a><span class="sd">        This function prints the ID-s of those robots of which the CONTROLLER is missing the information about</span>
</span><span id="Controller.print_missing_robot_info-353"><a href="#Controller.print_missing_robot_info-353"><span class="linenos">353</span></a><span class="sd">        (have not received a RobotInfo.msg for these robots with the id of the current cycle).  </span>
</span><span id="Controller.print_missing_robot_info-354"><a href="#Controller.print_missing_robot_info-354"><span class="linenos">354</span></a>
</span><span id="Controller.print_missing_robot_info-355"><a href="#Controller.print_missing_robot_info-355"><span class="linenos">355</span></a><span class="sd">        This function is used as a help-function for diagnostic purposes.</span>
</span><span id="Controller.print_missing_robot_info-356"><a href="#Controller.print_missing_robot_info-356"><span class="linenos">356</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Controller.print_missing_robot_info-357"><a href="#Controller.print_missing_robot_info-357"><span class="linenos">357</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing RobotInfo.msg for the robots with the following IDs: [&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Controller.print_missing_robot_info-358"><a href="#Controller.print_missing_robot_info-358"><span class="linenos">358</span></a>        <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Controller.print_missing_robot_info-359"><a href="#Controller.print_missing_robot_info-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_init</span><span class="p">:</span>
</span><span id="Controller.print_missing_robot_info-360"><a href="#Controller.print_missing_robot_info-360"><span class="linenos">360</span></a>            <span class="k">if</span> <span class="n">robot</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Controller.print_missing_robot_info-361"><a href="#Controller.print_missing_robot_info-361"><span class="linenos">361</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Controller.print_missing_robot_info-362"><a href="#Controller.print_missing_robot_info-362"><span class="linenos">362</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Controller.print_missing_robot_info-363"><a href="#Controller.print_missing_robot_info-363"><span class="linenos">363</span></a>            <span class="nb">id</span> <span class="o">+=</span><span class="mi">1</span>
</span><span id="Controller.print_missing_robot_info-364"><a href="#Controller.print_missing_robot_info-364"><span class="linenos">364</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function prints the ID-s of those robots of which the CONTROLLER is missing the information about
(have not received a RobotInfo.msg for these robots with the id of the current cycle).  </p>

<p>This function is used as a help-function for diagnostic purposes.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>rclpy.node.Node</dt>
                                <dd id="Controller.PARAM_REL_TOL" class="variable">PARAM_REL_TOL</dd>
                <dd id="Controller.publishers" class="variable">publishers</dd>
                <dd id="Controller.subscriptions" class="variable">subscriptions</dd>
                <dd id="Controller.clients" class="variable">clients</dd>
                <dd id="Controller.services" class="variable">services</dd>
                <dd id="Controller.timers" class="variable">timers</dd>
                <dd id="Controller.guards" class="variable">guards</dd>
                <dd id="Controller.waitables" class="variable">waitables</dd>
                <dd id="Controller.executor" class="variable">executor</dd>
                <dd id="Controller.context" class="variable">context</dd>
                <dd id="Controller.default_callback_group" class="variable">default_callback_group</dd>
                <dd id="Controller.handle" class="variable">handle</dd>
                <dd id="Controller.get_name" class="function">get_name</dd>
                <dd id="Controller.get_namespace" class="function">get_namespace</dd>
                <dd id="Controller.get_clock" class="function">get_clock</dd>
                <dd id="Controller.get_logger" class="function">get_logger</dd>
                <dd id="Controller.declare_parameter" class="function">declare_parameter</dd>
                <dd id="Controller.declare_parameters" class="function">declare_parameters</dd>
                <dd id="Controller.undeclare_parameter" class="function">undeclare_parameter</dd>
                <dd id="Controller.has_parameter" class="function">has_parameter</dd>
                <dd id="Controller.get_parameters" class="function">get_parameters</dd>
                <dd id="Controller.get_parameter" class="function">get_parameter</dd>
                <dd id="Controller.get_parameter_or" class="function">get_parameter_or</dd>
                <dd id="Controller.get_parameters_by_prefix" class="function">get_parameters_by_prefix</dd>
                <dd id="Controller.set_parameters" class="function">set_parameters</dd>
                <dd id="Controller.set_parameters_atomically" class="function">set_parameters_atomically</dd>
                <dd id="Controller.add_on_set_parameters_callback" class="function">add_on_set_parameters_callback</dd>
                <dd id="Controller.remove_on_set_parameters_callback" class="function">remove_on_set_parameters_callback</dd>
                <dd id="Controller.describe_parameter" class="function">describe_parameter</dd>
                <dd id="Controller.describe_parameters" class="function">describe_parameters</dd>
                <dd id="Controller.set_descriptor" class="function">set_descriptor</dd>
                <dd id="Controller.set_parameters_callback" class="function">set_parameters_callback</dd>
                <dd id="Controller.add_waitable" class="function">add_waitable</dd>
                <dd id="Controller.remove_waitable" class="function">remove_waitable</dd>
                <dd id="Controller.create_publisher" class="function">create_publisher</dd>
                <dd id="Controller.create_subscription" class="function">create_subscription</dd>
                <dd id="Controller.create_client" class="function">create_client</dd>
                <dd id="Controller.create_service" class="function">create_service</dd>
                <dd id="Controller.create_timer" class="function">create_timer</dd>
                <dd id="Controller.create_guard_condition" class="function">create_guard_condition</dd>
                <dd id="Controller.create_rate" class="function">create_rate</dd>
                <dd id="Controller.destroy_publisher" class="function">destroy_publisher</dd>
                <dd id="Controller.destroy_subscription" class="function">destroy_subscription</dd>
                <dd id="Controller.destroy_client" class="function">destroy_client</dd>
                <dd id="Controller.destroy_service" class="function">destroy_service</dd>
                <dd id="Controller.destroy_timer" class="function">destroy_timer</dd>
                <dd id="Controller.destroy_guard_condition" class="function">destroy_guard_condition</dd>
                <dd id="Controller.destroy_rate" class="function">destroy_rate</dd>
                <dd id="Controller.destroy_node" class="function">destroy_node</dd>
                <dd id="Controller.get_publisher_names_and_types_by_node" class="function">get_publisher_names_and_types_by_node</dd>
                <dd id="Controller.get_subscriber_names_and_types_by_node" class="function">get_subscriber_names_and_types_by_node</dd>
                <dd id="Controller.get_service_names_and_types_by_node" class="function">get_service_names_and_types_by_node</dd>
                <dd id="Controller.get_client_names_and_types_by_node" class="function">get_client_names_and_types_by_node</dd>
                <dd id="Controller.get_topic_names_and_types" class="function">get_topic_names_and_types</dd>
                <dd id="Controller.get_service_names_and_types" class="function">get_service_names_and_types</dd>
                <dd id="Controller.get_node_names" class="function">get_node_names</dd>
                <dd id="Controller.get_node_names_and_namespaces" class="function">get_node_names_and_namespaces</dd>
                <dd id="Controller.get_node_names_and_namespaces_with_enclaves" class="function">get_node_names_and_namespaces_with_enclaves</dd>
                <dd id="Controller.count_publishers" class="function">count_publishers</dd>
                <dd id="Controller.count_subscribers" class="function">count_subscribers</dd>
                <dd id="Controller.get_publishers_info_by_topic" class="function">get_publishers_info_by_topic</dd>
                <dd id="Controller.get_subscriptions_info_by_topic" class="function">get_subscriptions_info_by_topic</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="run">
                            <input id="run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="run-366"><a href="#run-366"><span class="linenos">366</span></a><span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
</span><span id="run-367"><a href="#run-367"><span class="linenos">367</span></a>
</span><span id="run-368"><a href="#run-368"><span class="linenos">368</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="run-369"><a href="#run-369"><span class="linenos">369</span></a><span class="sd">        **Main function**: creates the CONTROLLER and runs the ros2 node in a while loop. </span>
</span><span id="run-370"><a href="#run-370"><span class="linenos">370</span></a>
</span><span id="run-371"><a href="#run-371"><span class="linenos">371</span></a><span class="sd">        While loop is runnning as long as the ros2 node **mapf_evaluator_node** exists.  </span>
</span><span id="run-372"><a href="#run-372"><span class="linenos">372</span></a><span class="sd">        Every loop cycle the ros2 node is spinned for a defined period (default: 0.1sec) so it can process all data.  </span>
</span><span id="run-373"><a href="#run-373"><span class="linenos">373</span></a>
</span><span id="run-374"><a href="#run-374"><span class="linenos">374</span></a><span class="sd">        &gt;   1) At the beginning of every cycle CONTROLLER finds itself in the state MODE_INIT.  </span>
</span><span id="run-375"><a href="#run-375"><span class="linenos">375</span></a>
</span><span id="run-376"><a href="#run-376"><span class="linenos">376</span></a><span class="sd">        &gt;    2) CONTROLLER changes it&#39;s state to MODE_WAIT_SIM after a MapInfo.msg is arrived   </span>
</span><span id="run-377"><a href="#run-377"><span class="linenos">377</span></a>
</span><span id="run-378"><a href="#run-378"><span class="linenos">378</span></a><span class="sd">        &gt;    3) CONTROLLER moves to the state MODE_PUB_INSTANCE after receiving all needed data</span>
</span><span id="run-379"><a href="#run-379"><span class="linenos">379</span></a><span class="sd">        (RobotInfo.msg for every robot in the map).    </span>
</span><span id="run-380"><a href="#run-380"><span class="linenos">380</span></a>
</span><span id="run-381"><a href="#run-381"><span class="linenos">381</span></a><span class="sd">        &gt;    4) After generating and publishing the instance (which can be solved by a pathplanner) </span>
</span><span id="run-382"><a href="#run-382"><span class="linenos">382</span></a><span class="sd">            CONTROLLER waits for the solution (state: MODE_WAIT_SOLVER).      </span>
</span><span id="run-383"><a href="#run-383"><span class="linenos">383</span></a>
</span><span id="run-384"><a href="#run-384"><span class="linenos">384</span></a><span class="sd">        &gt;    5) After receiving a solution from a pathplanner CONTROLLER generates actions for the robots</span>
</span><span id="run-385"><a href="#run-385"><span class="linenos">385</span></a><span class="sd">            (state: MODE_PUB_SIM). After sending the actions to the SIMULATION the CONTROLLER </span>
</span><span id="run-386"><a href="#run-386"><span class="linenos">386</span></a><span class="sd">            goes back to the initial state MODE_INIT.</span>
</span><span id="run-387"><a href="#run-387"><span class="linenos">387</span></a>
</span><span id="run-388"><a href="#run-388"><span class="linenos">388</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="run-389"><a href="#run-389"><span class="linenos">389</span></a>
</span><span id="run-390"><a href="#run-390"><span class="linenos">390</span></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span><span id="run-391"><a href="#run-391"><span class="linenos">391</span></a>    <span class="n">controller</span> <span class="o">=</span> <span class="n">Controller</span><span class="p">()</span>
</span><span id="run-392"><a href="#run-392"><span class="linenos">392</span></a>
</span><span id="run-393"><a href="#run-393"><span class="linenos">393</span></a>    <span class="c1">#spin ros for 0.1seconds</span>
</span><span id="run-394"><a href="#run-394"><span class="linenos">394</span></a>    <span class="c1">#time_spin = 2.0</span>
</span><span id="run-395"><a href="#run-395"><span class="linenos">395</span></a>    <span class="n">time_spin</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="run-396"><a href="#run-396"><span class="linenos">396</span></a>    <span class="c1">#after publishing the MAPFInstance message to the solver wait for the solution</span>
</span><span id="run-397"><a href="#run-397"><span class="linenos">397</span></a>    <span class="c1">#if after the given timeout no solution received from the solver then publish the MAPFInstance messsage again</span>
</span><span id="run-398"><a href="#run-398"><span class="linenos">398</span></a>    <span class="n">timeout_pub_instance</span> <span class="o">=</span> <span class="mf">60.0</span>  
</span><span id="run-399"><a href="#run-399"><span class="linenos">399</span></a>    
</span><span id="run-400"><a href="#run-400"><span class="linenos">400</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STATE: Waiting for the MapInfo.msg to the topic /mapf_map_info&quot;</span><span class="p">)</span>
</span><span id="run-401"><a href="#run-401"><span class="linenos">401</span></a>
</span><span id="run-402"><a href="#run-402"><span class="linenos">402</span></a>    <span class="k">while</span><span class="p">(</span><span class="n">rclpy</span><span class="o">.</span><span class="n">ok</span><span class="p">()):</span>            
</span><span id="run-403"><a href="#run-403"><span class="linenos">403</span></a>
</span><span id="run-404"><a href="#run-404"><span class="linenos">404</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="run-405"><a href="#run-405"><span class="linenos">405</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;; STATE of the CONTROLLER: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span><span class="p">))</span>
</span><span id="run-406"><a href="#run-406"><span class="linenos">406</span></a>
</span><span id="run-407"><a href="#run-407"><span class="linenos">407</span></a>        <span class="c1">#spin ros2 for a certain time to get all the messages</span>
</span><span id="run-408"><a href="#run-408"><span class="linenos">408</span></a>        <span class="n">timeout_spin</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">time_spin</span>
</span><span id="run-409"><a href="#run-409"><span class="linenos">409</span></a>        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">&lt;</span><span class="n">timeout_spin</span><span class="p">:</span>
</span><span id="run-410"><a href="#run-410"><span class="linenos">410</span></a>            <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="run-411"><a href="#run-411"><span class="linenos">411</span></a>        
</span><span id="run-412"><a href="#run-412"><span class="linenos">412</span></a>        <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="run-413"><a href="#run-413"><span class="linenos">413</span></a>        
</span><span id="run-414"><a href="#run-414"><span class="linenos">414</span></a>        <span class="c1">#STATE 0: wait till a MapInfo.msg received    </span>
</span><span id="run-415"><a href="#run-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_INIT</span><span class="p">:</span>
</span><span id="run-416"><a href="#run-416"><span class="linenos">416</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_INIT - Waiting for MapInfo.msg to the topic /mapf_map_info&quot;</span><span class="p">)</span>
</span><span id="run-417"><a href="#run-417"><span class="linenos">417</span></a>            <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">_map_received</span><span class="p">:</span>
</span><span id="run-418"><a href="#run-418"><span class="linenos">418</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_WAIT_SIM</span>
</span><span id="run-419"><a href="#run-419"><span class="linenos">419</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="run-420"><a href="#run-420"><span class="linenos">420</span></a>                <span class="k">continue</span>
</span><span id="run-421"><a href="#run-421"><span class="linenos">421</span></a>    
</span><span id="run-422"><a href="#run-422"><span class="linenos">422</span></a>        <span class="c1">#STATE 1: wait till all RobotInfo.msg received    </span>
</span><span id="run-423"><a href="#run-423"><span class="linenos">423</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_WAIT_SIM</span><span class="p">:</span>
</span><span id="run-424"><a href="#run-424"><span class="linenos">424</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_WAIT_SIM - Waiting for all RobotInfo.msg to the topic /mapf_robot_info_X where X = ID of the robot&quot;</span><span class="p">)</span>
</span><span id="run-425"><a href="#run-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">check_init_robots</span><span class="p">():</span>
</span><span id="run-426"><a href="#run-426"><span class="linenos">426</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">controller</span><span class="o">.</span><span class="n">all_agents_at_target</span><span class="p">():</span>
</span><span id="run-427"><a href="#run-427"><span class="linenos">427</span></a>                    <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_PUB_INSTANCE</span>
</span><span id="run-428"><a href="#run-428"><span class="linenos">428</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="run-429"><a href="#run-429"><span class="linenos">429</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: All robots have already reached their target, return to STATE 0&quot;</span><span class="p">)</span>
</span><span id="run-430"><a href="#run-430"><span class="linenos">430</span></a>                    <span class="k">continue</span>
</span><span id="run-431"><a href="#run-431"><span class="linenos">431</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="run-432"><a href="#run-432"><span class="linenos">432</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">print_missing_robot_info</span><span class="p">()</span>
</span><span id="run-433"><a href="#run-433"><span class="linenos">433</span></a>                <span class="k">continue</span>
</span><span id="run-434"><a href="#run-434"><span class="linenos">434</span></a>            
</span><span id="run-435"><a href="#run-435"><span class="linenos">435</span></a>        <span class="c1">#STATE 2: create and publish a MAPFInstance.msg (composed of MapInfo.msg and all RobotInfo.msg)</span>
</span><span id="run-436"><a href="#run-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_PUB_INSTANCE</span><span class="p">:</span>
</span><span id="run-437"><a href="#run-437"><span class="linenos">437</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_PUB_INSTANCE - Create and publish a MAPFInstance.msg to the topic /mapf_instance_info&quot;</span><span class="p">)</span>
</span><span id="run-438"><a href="#run-438"><span class="linenos">438</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">publish_instance_msg</span><span class="p">()</span>                
</span><span id="run-439"><a href="#run-439"><span class="linenos">439</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_WAIT_SOLVER</span>
</span><span id="run-440"><a href="#run-440"><span class="linenos">440</span></a>            <span class="n">time_repeat</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout_pub_instance</span>
</span><span id="run-441"><a href="#run-441"><span class="linenos">441</span></a>        <span class="c1">#STATE 3: wait till a MAPFSolution.msg received)</span>
</span><span id="run-442"><a href="#run-442"><span class="linenos">442</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_WAIT_SOLVER</span><span class="p">:</span>
</span><span id="run-443"><a href="#run-443"><span class="linenos">443</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_WAIT_SOLVER - Waiting for solution from pathplanner&quot;</span><span class="p">)</span>
</span><span id="run-444"><a href="#run-444"><span class="linenos">444</span></a>            
</span><span id="run-445"><a href="#run-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">_solution_msgs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="run-446"><a href="#run-446"><span class="linenos">446</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_PUB_SIM</span>
</span><span id="run-447"><a href="#run-447"><span class="linenos">447</span></a>            <span class="c1">#if after 30sec no answer received from solver then go back to STATE 2 (pub MAPFInstance.msg again)</span>
</span><span id="run-448"><a href="#run-448"><span class="linenos">448</span></a>            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">&gt;</span><span class="n">time_repeat</span><span class="p">:</span>
</span><span id="run-449"><a href="#run-449"><span class="linenos">449</span></a>                <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_PUB_INSTANCE</span>
</span><span id="run-450"><a href="#run-450"><span class="linenos">450</span></a>        <span class="c1">#STATE 4: create and publish RobotAction.msg for the simulation</span>
</span><span id="run-451"><a href="#run-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">==</span> <span class="n">MODE_PUB_SIM</span><span class="p">:</span>
</span><span id="run-452"><a href="#run-452"><span class="linenos">452</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details: MODE_PUB_SIM - Create and publish RobotAction.msg for every robot&quot;</span><span class="p">)</span>
</span><span id="run-453"><a href="#run-453"><span class="linenos">453</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">publish_action_msg</span><span class="p">(</span><span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
</span><span id="run-454"><a href="#run-454"><span class="linenos">454</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">publish_statistics_msg</span><span class="p">(</span><span class="n">solution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
</span><span id="run-455"><a href="#run-455"><span class="linenos">455</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">_solution_msgs</span> <span class="o">=</span> <span class="p">[]</span>               
</span><span id="run-456"><a href="#run-456"><span class="linenos">456</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">_map_received</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="run-457"><a href="#run-457"><span class="linenos">457</span></a>            <span class="n">controller</span><span class="o">.</span><span class="n">ctrl_state</span> <span class="o">=</span> <span class="n">MODE_INIT</span>
</span><span id="run-458"><a href="#run-458"><span class="linenos">458</span></a>            
</span><span id="run-459"><a href="#run-459"><span class="linenos">459</span></a>    <span class="c1">#end while loop</span>
</span></pre></div>


            <div class="docstring"><p><strong>Main function</strong>: creates the CONTROLLER and runs the ros2 node in a while loop. </p>

<p>While loop is runnning as long as the ros2 node <strong>mapf_evaluator_node</strong> exists. <br />
Every loop cycle the ros2 node is spinned for a defined period (default: 0.1sec) so it can process all data.  </p>

<blockquote>
  <p>1) At the beginning of every cycle CONTROLLER finds itself in the state MODE_INIT.  </p>
</blockquote>

<blockquote>
  <p>2) CONTROLLER changes it's state to MODE_WAIT_SIM after a MapInfo.msg is arrived   </p>
</blockquote>

<blockquote>
  <p>3) CONTROLLER moves to the state MODE_PUB_INSTANCE after receiving all needed data
  (RobotInfo.msg for every robot in the map).    </p>
</blockquote>

<blockquote>
  <p>4) After generating and publishing the instance (which can be solved by a pathplanner) 
      CONTROLLER waits for the solution (state: MODE_WAIT_SOLVER).      </p>
</blockquote>

<blockquote>
  <p>5) After receiving a solution from a pathplanner CONTROLLER generates actions for the robots
      (state: MODE_PUB_SIM). After sending the actions to the SIMULATION the CONTROLLER 
      goes back to the initial state MODE_INIT.</p>
</blockquote>
</div>


                </section>
    </main>
</body>
</html>